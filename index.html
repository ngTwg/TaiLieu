<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>AstroMind - Khai Phá Tri Thức Vũ Trụ | Đề Thi & Tài Liệu Học Tập</title>
    <meta name="description" content="AstroMind - Nền tảng tài liệu học tập #1 Việt Nam. Đề thi Giữa kì, Cuối kì chất lượng cao và tài khoản Premium với giá tốt nhất.">
    <meta name="keywords" content="đề thi giữa kì, đề thi cuối kì, tài liệu học tập, toán cao cấp, vật lý đại cương, lập trình C++, ChatGPT, Canva Pro">
    <meta name="author" content="AstroMind">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://astromind.vn/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://astromind.vn/">
    <meta property="og:title" content="AstroMind - Khai Phá Tri Thức Vũ Trụ">
    <meta property="og:description" content="Nền tảng tài liệu học tập #1 Việt Nam. Đề thi chất lượng cao và tài khoản Premium.">
    <meta property="og:image" content="https://astromind.vn/og-image.jpg">
    <meta property="og:locale" content="vi_VN">
    <meta property="og:site_name" content="AstroMind">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://astromind.vn/">
    <meta name="twitter:title" content="AstroMind - Khai Phá Tri Thức Vũ Trụ">
    <meta name="twitter:description" content="Nền tảng tài liệu học tập #1 Việt Nam.">
    <meta name="twitter:image" content="https://astromind.vn/twitter-image.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "EducationalOrganization",
        "name": "AstroMind",
        "description": "Nền tảng tài liệu học tập #1 Việt Nam",
        "url": "https://astromind.vn",
        "logo": "https://astromind.vn/logo.png",
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer service",
            "availableLanguage": "Vietnamese"
        }
    }
    </script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font hỗ trợ tiếng Việt tốt -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Be Vietnam Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
        }
        
        @keyframes marquee { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        .animate-marquee { animation: marquee 40s linear infinite; }
        .animate-marquee:hover { animation-play-state: paused; }
        
        @keyframes float {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float 6s ease-out infinite; }
        
        @keyframes fade-in-down {
          from { opacity: 0; transform: translateY(-20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down { animation: fade-in-down 0.5s ease-out; }
        
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out; }

        .star-shooting span {
          position: absolute;
          top: 50%;
          left: 50%;
          width: 4px;
          height: 4px;
          background: #fff;
          border-radius: 50%;
          box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1), 0 0 0 8px rgba(255, 255, 255, 0.1), 0 0 20px rgba(255, 255, 255, 1);
          animation: shooting 3s linear infinite;
          opacity: 0;
        }
        .star-shooting span::before {
          content: '';
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          width: 300px;
          height: 1px;
          background: linear-gradient(90deg, #fff, transparent);
        }
        @keyframes shooting {
          0% { transform: rotate(315deg) translateX(0); opacity: 1; }
          70% { opacity: 1; }
          100% { transform: rotate(315deg) translateX(-1000px); opacity: 0; }
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        .sold-out-overlay { position: relative; }
        .sold-out-overlay::after {
            content: 'HẾT HÀNG';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-12deg);
            background: rgba(220, 38, 38, 0.9);
            color: white;
            padding: 8px 16px;
            font-weight: bold;
            border-radius: 8px;
            border: 2px solid rgba(248, 113, 113, 0.8);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 30;
        }

        .package-card {
            transition: all 0.3s ease;
        }
        .package-card:hover:not(.sold-out) {
            transform: translateY(-4px);
        }
        .package-card.selected {
            border-color: rgba(6, 182, 212, 0.8) !important;
            background: rgba(6, 182, 212, 0.1) !important;
        }
        .package-card.popular {
            border-color: rgba(168, 85, 247, 0.5);
        }
        .package-card.sold-out {
            cursor: not-allowed;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            width: 100%;
        }
        
        /* Legal page styles */
        .legal-content h3 {
            color: #22d3ee;
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        
        .legal-content p {
            color: #9ca3af;
            margin-bottom: 1rem;
            line-height: 1.7;
        }
        
        .legal-content ul {
            list-style: disc;
            margin-left: 1.5rem;
            color: #9ca3af;
            margin-bottom: 1rem;
        }
        
        .legal-content li {
            margin-bottom: 0.5rem;
        }

        /* Tránh Layout Shift - Set aspect-ratio cho ảnh */
        .course-image-container {
            aspect-ratio: 16 / 9;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        }

        /* Skeleton Loading Animation */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        /* GPU Acceleration với will-change */
        .glass-card {
            will-change: transform, opacity;
        }
        .animate-float {
            will-change: transform;
        }
        .animate-marquee {
            will-change: transform;
        }

        /* Banner chéo góc trái trên */
        .ribbon-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 85px;
            height: 85px;
            overflow: hidden;
            z-index: 10;
        }
        .ribbon {
            position: absolute;
            top: 18px;
            left: -25px;
            width: 120px;
            padding: 4px 0;
            text-align: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
            transform: rotate(-45deg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .ribbon-popular {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
        }
        .ribbon-best {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
        }

        /* Button loading state */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Copy button styles */
        .copy-btn {
            transition: all 0.2s ease;
        }
        .copy-btn:hover {
            transform: scale(1.1);
        }
        .copy-btn:active {
            transform: scale(0.95);
        }
        .copy-btn.copied {
            color: #10b981 !important;
        }

        /* University tag styles */
        .university-tag {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        /* Search loading modal */
        .search-loading-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        /* Affiliate input styles */
        .aff-input-valid {
            border-color: rgba(34, 197, 94, 0.5) !important;
            background: rgba(34, 197, 94, 0.1) !important;
        }
        .aff-input-invalid {
            border-color: rgba(239, 68, 68, 0.5) !important;
            background: rgba(239, 68, 68, 0.1) !important;
        }
        .aff-input-checking {
            border-color: rgba(234, 179, 8, 0.5) !important;
        }

        /* Affiliate Section Styles */
        .affiliate-card {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .affiliate-card:hover {
            border-color: rgba(168, 85, 247, 0.5);
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(236, 72, 153, 0.15) 100%);
        }

        /* Tab styles */
        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            color: white;
        }
        .tab-btn:not(.active):hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Stats card in affiliate */
        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Commission table */
        .commission-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .commission-table th {
            background: rgba(168, 85, 247, 0.2);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: #e879f9;
            border-bottom: 1px solid rgba(168, 85, 247, 0.3);
        }
        .commission-table td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .commission-table tr:hover td {
            background: rgba(255, 255, 255, 0.03);
        }

        /* How it works step card */
        .step-card {
            transition: all 0.3s ease;
        }
        .step-card:hover {
            transform: translateY(-4px);
            border-color: rgba(251, 191, 36, 0.3);
            background: rgba(251, 191, 36, 0.05);
        }
    </style>
</head>
<body class="bg-black text-gray-100 font-sans selection:bg-cyan-500 selection:text-white overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback, memo } = React;

        // --- Hàm tối ưu ảnh Unsplash ---
        const optimizeImageUrl = (url, width = 600, quality = 80) => {
            if (!url) return '';
            if (url.includes('unsplash.com')) {
                const separator = url.includes('?') ? '&' : '?';
                return `${url}${separator}w=${width}&q=${quality}&fm=webp&fit=crop`;
            }
            return url;
        };

        // --- ICONS ---
        const IconStar = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const IconCheck = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const IconCheckCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const IconMenu = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>;
        const IconX = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const IconSparkles = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>;
        const IconRocket = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>;
        const IconHelpCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>;
        const IconBookOpen = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const IconUsers = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const IconAward = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>;
        const IconClock = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconShield = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const IconZap = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
        const IconGift = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></svg>;
        const IconHeart = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>;
        const IconArrowRight = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>;
        const IconPhone = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>;
        const IconShoppingCart = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>;
        const IconLoader = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>;
        const IconSearch = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconCopy = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const IconChevronRight = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>;
        const IconPlus = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const IconMinus = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>;
        const IconAlertCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;
        const IconSend = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>;
        const IconRefresh = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const IconGraduationCap = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>;
        const IconClipboardList = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>;
        const IconFileEdit = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 13.5V4a2 2 0 0 1 2-2h8.5L20 7.5V20a2 2 0 0 1-2 2h-5.5"/><polyline points="14 2 14 8 20 8"/><path d="M10.42 12.61a2.1 2.1 0 1 1 2.97 2.97L7.95 21 4 22l.99-3.95 5.43-5.44Z"/></svg>;
        const IconFileText = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>;
        const IconPlayCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>;
        const IconPackage = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>;
        const IconTag = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>;
        const IconCode = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>;
        const IconExternalLink = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>;
        const IconFileCode = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10 13-2 2 2 2"/><path d="m14 17 2-2-2-2"/></svg>;
        const IconScale = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>;
        const IconLock = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const IconRotateCcw = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const IconMail = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>;
        const IconAlertTriangle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>;
        const IconBuilding = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/></svg>;
        const IconPercent = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" x2="5" y1="5" y2="19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/></svg>;
        const IconTicket = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></svg>;
        const IconDollarSign = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const IconTrendingUp = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
        const IconWallet = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>;
        const IconCreditCard = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>;
        const IconUserPlus = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>;

        // Brand Icons
        const IconZalo = (props) => (
            <svg {...props} viewBox="0 0 50 50" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                 <path d="M25 4C13.4 4 4 11.8 4 21.4c0 4.1 1.7 8 4.7 11-.2 2.7-1.7 6.3-4.2 8.7 4.9.4 9.1-2 11.2-4.1 2.8 1.4 6 2.2 9.3 2.2 11.6 0 21-7.8 21-17.4S36.6 4 25 4zm4.1 23h-8.2v-2.1l6.1-8.6h-5.9v-2.8H29v2.1l-6.1 8.7h6.2v2.7z"/>
            </svg>
        );
        const IconGoogle = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .533 5.347.533 12S5.867 24 12.48 24c3.44 0 6.053-1.147 8.16-3.293 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.12H12.48z"/>
            </svg>
        );
        const IconChatGPT = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.98 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.516 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.872zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08L8.704 5.46a.795.795 0 0 0-.393.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z"/>
            </svg>
        );
        const IconCanva = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12.001 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75-4.365-9.75-9.75-9.75zm3.75 14.25c-1.875 0-3.375-1.2-3.75-3.075-.075-.375-.075-.675-.075-1.05 0-2.1 1.65-3.825 3.75-3.825.6 0 1.05.075 1.5.3.15.075.225.225.225.375v.075c0 .15-.075.3-.225.375l-.6.375c-.15.075-.3.075-.45 0-.15-.075-.3-.15-.45-.15-.975 0-1.8.825-1.8 1.8s.825 1.8 1.8 1.8c.525 0 1.05-.225 1.35-.675.075-.15.225-.15.45-.075l.525.375c.15.075.15.3.075.45-.45.75-1.275 1.2-2.325 1.2z"/>
            </svg>
        );

        // --- CONFIG ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxglYEl8WPc1OBHmn3XX6XXuSJpGCjN8Hf8EkvLFaKhgpmZDjcsgu4UksqhDv2IKmYINQ/exec";

        const BANK_INFO = {
            bankId: "MB",
            accountNum: "11166774411",
            accountName: "LE NGOC TUONG",
            qrLink: "https://img.vietqr.io/image/MB-11166774411-compact2.jpg"
        };

        const AFFILIATE_COMMISSION_RATE = 0.20;

        const VIETNAM_BANKS = [
            { id: 'vcb', name: 'Vietcombank' },
            { id: 'tcb', name: 'Techcombank' },
            { id: 'mb', name: 'MB Bank' },
            { id: 'acb', name: 'ACB' },
            { id: 'bidv', name: 'BIDV' },
            { id: 'vib', name: 'VIB' },
            { id: 'tpb', name: 'TPBank' },
            { id: 'vpb', name: 'VPBank' },
            { id: 'shb', name: 'SHB' },
            { id: 'msb', name: 'MSB' },
            { id: 'ocb', name: 'OCB' },
            { id: 'hdbank', name: 'HDBank' },
            { id: 'scb', name: 'SCB' },
            { id: 'seabank', name: 'SeABank' },
            { id: 'agr', name: 'Agribank' },
            { id: 'vtin', name: 'Vietinbank' },
            { id: 'sacombank', name: 'Sacombank' },
            { id: 'eximbank', name: 'Eximbank' },
            { id: 'lpb', name: 'LienVietPostBank' },
            { id: 'pvcom', name: 'PVcomBank' },
            { id: 'other', name: 'Ngân hàng khác' }
        ];

        const UNIVERSITIES = [
            { id: 'vlu', name: 'Văn Lang', color: 'from-red-500 to-orange-500' },
            { id: 'hutech', name: 'HUTECH', color: 'from-blue-500 to-cyan-500' },
            { id: 'ueh', name: 'UEH', color: 'from-green-500 to-emerald-500' },
            { id: 'hcmut', name: 'Bách Khoa', color: 'from-blue-600 to-indigo-600' },
            { id: 'hcmus', name: 'KHTN', color: 'from-purple-500 to-pink-500' },
            { id: 'fpt', name: 'FPT', color: 'from-orange-500 to-amber-500' },
        ];

        const PACKAGE_CONFIG = {
            pdf: { id: 'pdf', name: 'File PDF', icon: <IconFileText className="w-5 h-5" />, price: 30000, priceDisplay: '30.000đ', description: 'File PDF đề thi + đáp án chi tiết', color: 'from-blue-500 to-cyan-500', features: ['Đề thi đầy đủ', 'Đáp án chi tiết', 'Tải về ngay'], stockKey: 'pdf' },
            quiz1: { id: 'quiz1', name: '1 Lượt Quiz', icon: <IconPlayCircle className="w-5 h-5" />, price: 6000, priceDisplay: '6.000đ', description: '1 lượt làm quiz trắc nghiệm online', color: 'from-green-500 to-emerald-500', features: ['1 lượt làm bài', 'Chấm điểm tự động', 'Xem đáp án sau khi nộp'], stockKey: 'quiz1' },
            quiz6: { id: 'quiz6', name: '6 Lượt Quiz', icon: <IconPlayCircle className="w-5 h-5" />, price: 30000, priceDisplay: '30.000đ', originalPrice: '36.000đ', description: '6 lượt làm quiz (tiết kiệm 17%)', color: 'from-emerald-500 to-teal-500', features: ['6 lượt làm bài', 'Tiết kiệm 6.000đ', 'Không giới hạn thời gian'], popular: true, stockKey: 'quiz6' },
            quiz10: { id: 'quiz10', name: '10 Lượt Quiz', icon: <IconPlayCircle className="w-5 h-5" />, price: 40000, priceDisplay: '40.000đ', originalPrice: '60.000đ', description: '10 lượt làm quiz (tiết kiệm 33%)', color: 'from-teal-500 to-cyan-500', features: ['10 lượt làm bài', 'Tiết kiệm 20.000đ', 'Ưu đãi tốt nhất'], stockKey: 'quiz10' },
            combo: { id: 'combo', name: 'Combo Tiết Kiệm', icon: <IconPackage className="w-5 h-5" />, price: 50000, priceDisplay: '50.000đ', originalPrice: '60.000đ', description: 'File PDF + 5 lượt Quiz', color: 'from-purple-500 to-pink-500', features: ['File PDF đầy đủ', '5 lượt làm Quiz', 'Tiết kiệm 10.000đ'], bestValue: true, stockKey: 'combo' }
        };

        const GIUAKI_DATA = [
            { id: 'gk1', title: "Toán Cao Cấp", description: "Bộ đề thi giữa kì môn Toán Cao Cấp kèm đáp án chi tiết và hướng dẫn giải.", image: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-toan-gk", tags: ["Toán", "Giữa kì"], subject: "Toán Cao Cấp", students: 1234, rating: 4.9, questionCount: 50, badge: "Bestseller", quantity: -1, packageStock: null, universities: ['vlu', 'hutech', 'ueh'] },
            { id: 'gk2', title: "Vật Lý Đại Cương", description: "Tổng hợp đề thi giữa kì Vật Lý Đại Cương từ nhiều trường đại học.", image: "https://images.unsplash.com/photo-1636466497217-26a8cbeaf0aa?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-vatly-gk", tags: ["Vật lý", "Giữa kì"], subject: "Vật Lý Đại Cương", students: 892, rating: 4.8, questionCount: 40, badge: "Hot", quantity: -1, packageStock: null, universities: ['hcmut', 'hcmus'] },
            { id: 'gk3', title: "Lập Trình C++", description: "Bộ đề giữa kì môn Lập Trình C++ với code mẫu và giải thích thuật toán.", image: "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-cpp-gk", tags: ["IT", "Giữa kì"], subject: "Lập Trình C++", students: 2156, rating: 4.95, questionCount: 35, badge: "Premium", quantity: -1, packageStock: null, universities: ['fpt', 'hutech', 'hcmut'] },
            { id: 'gk4', title: "Hóa Đại Cương", description: "Đề thi giữa kì Hóa Đại Cương với lời giải chi tiết từng bước.", image: "https://images.unsplash.com/photo-1532634922-8fe0b757fb13?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-hoa-gk", tags: ["Hóa học", "Giữa kì"], subject: "Hóa Đại Cương", students: 756, rating: 4.7, questionCount: 45, badge: "", quantity: -1, packageStock: null, universities: ['vlu', 'hcmus'] },
            { id: 'gk5', title: "Tiếng Anh", description: "Bộ đề giữa kì Tiếng Anh theo chuẩn TOEIC format.", image: "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-english-gk", tags: ["Tiếng Anh", "Giữa kì"], subject: "Tiếng Anh", students: 1890, rating: 4.85, questionCount: 60, badge: "Hot", quantity: -1, packageStock: null, universities: ['ueh', 'vlu', 'fpt'] }
        ];

        const CUOIKI_DATA = [
            { id: 'ck1', title: "Toán Cao Cấp", description: "Trọn bộ đề thi cuối kì môn Toán Cao Cấp với đáp án chi tiết từ A-Z.", image: "https://images.unsplash.com/photo-1509228468518-180dd4864904?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-toan-ck", tags: ["Toán", "Cuối kì"], subject: "Toán Cao Cấp", students: 3456, rating: 4.95, questionCount: 80, badge: "Bestseller", quantity: -1, packageStock: null, universities: ['vlu', 'hutech', 'ueh', 'hcmut'] },
            { id: 'ck2', title: "Vật Lý Đại Cương", description: "Bộ đề cuối kì Vật Lý Đại Cương đầy đủ nhất, cập nhật mới nhất 2024.", image: "https://images.unsplash.com/photo-1532094349884-543bc11b234d?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-vatly-ck", tags: ["Vật lý", "Cuối kì"], subject: "Vật Lý Đại Cương", students: 1567, rating: 4.85, questionCount: 70, badge: "Hot", quantity: -1, packageStock: null, universities: ['hcmut', 'hcmus', 'hutech'] },
            { id: 'ck3', title: "Lập Trình C++", description: "Tuyển tập đề cuối kì C++ từ cơ bản đến nâng cao, có video giải chi tiết.", image: "https://images.unsplash.com/photo-1542831371-29b0f74f9713?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-cpp-ck", tags: ["IT", "Cuối kì"], subject: "Lập Trình C++", students: 2890, rating: 4.9, questionCount: 55, badge: "Premium", quantity: -1, packageStock: null, universities: ['fpt', 'hutech', 'hcmut', 'vlu'] },
            { id: 'ck4', title: "Hóa Đại Cương", description: "Đề thi cuối kì Hóa Đại Cương tổng hợp từ nhiều trường ĐH.", image: "https://images.unsplash.com/photo-1603126857599-f6e157fa2fe6?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-hoa-ck", tags: ["Hóa học", "Cuối kì"], subject: "Hóa Đại Cương", students: 945, rating: 4.75, questionCount: 65, badge: "", quantity: -1, packageStock: null, universities: ['vlu', 'hcmus'] },
            { id: 'ck5', title: "Tiếng Anh", description: "Bộ đề cuối kì Tiếng Anh chuẩn format TOEIC, IELTS Academic.", image: "https://images.unsplash.com/photo-1434030216411-0b793f4b4173?auto=format&fit=crop&q=80&w=600", trialLink: "https://forms.gle/example-english-ck", tags: ["Tiếng Anh", "Cuối kì"], subject: "Tiếng Anh", students: 2340, rating: 4.88, questionCount: 90, badge: "Bestseller", quantity: -1, packageStock: null, universities: ['ueh', 'vlu', 'fpt', 'hutech'] }
        ];

        const ACCOUNTS_DATA = [
            { id: 'google', title: "Tài khoản Google", description: "12 tháng, 2 TB Drive, tạo ảnh Nana Banana Pro, Gemini 3 Pro, 1k credit Video Veo 3.1.", price: "200.000đ", priceVal: 200000, platform: "Google", icon: <IconGoogle className="w-8 h-8 text-blue-400" />, color: "from-blue-500 to-red-500", features: ["2TB Storage", "Gemini 3 Pro", "Veo 3.1 Video"], quantity: -1 },
            { id: 'chatgpt', title: "ChatGPT Plus", description: "Gói 1 tháng, sử dụng Model GPT-5.2 Thinking mới nhất.", price: "200.000đ", priceVal: 200000, platform: "OpenAI", icon: <IconChatGPT className="w-8 h-8 text-emerald-400" />, color: "from-emerald-500 to-teal-600", features: ["GPT-5.2 Thinking", "DALL-E 3"], quantity: -1 },
            { id: 'go', title: "ChatGPT Go 1 Năm", description: "Giải pháp ChatGPT Go học tập toàn diện.", price: "300.000đ", priceVal: 300000, platform: "OpenAI", icon: <IconRocket className="w-8 h-8 text-orange-400" />, color: "from-orange-500 to-amber-500", features: ["Bản quyền 1 năm", "Full tính năng"], quantity: -1 },
            { id: 'edu', title: "ChatGPT Edu 1 Năm", description: "Tài khoản ChatGPT Edu chính chủ dành cho giáo dục.", price: "300.000đ", priceVal: 300000, platform: "OpenAI", icon: <IconBookOpen className="w-8 h-8 text-blue-400" />, color: "from-blue-600 to-indigo-600", features: ["Ưu đãi sinh viên", "Bảo hành 1 năm"], quantity: -1 },
            { id: 'canva', title: "Canva Pro (Edu)", description: "Join lớp Edu, sử dụng đầy đủ tính năng Pro. 50k/slot/năm.", price: "50.000đ", priceVal: 50000, platform: "Canva", icon: <IconCanva className="w-8 h-8 text-cyan-400" />, color: "from-purple-600 to-pink-500", features: ["Magic Resize", "Pro Assets", "1 Năm"], quantity: -1 },
            { id: 'contact', title: "Yêu cầu App Khác", description: "Liên hệ để được tư vấn phần mềm khác.", price: "Liên hệ", priceVal: 0, platform: "Support", icon: <IconHelpCircle className="w-8 h-8 text-amber-400" />, color: "from-amber-500 to-orange-400", isContact: true, features: ["Tư vấn miễn phí", "Hỗ trợ 24/7"], quantity: 999 }
        ];

        const SOURCE_CODE_DATA = [
            { id: 'sc1', title: "Website Bán Đề Thi", description: "Template website bán đề thi/tài liệu với React + Tailwind CSS. Tích hợp thanh toán QR, quản lý đơn hàng qua Google Sheets.", price: "500.000đ", priceVal: 500000, icon: <IconCode className="w-8 h-8 text-cyan-400" />, color: "from-cyan-500 to-blue-600", features: ["React + Tailwind", "Google Sheets API", "QR Payment", "Full Source"], demoLink: "#", quantity: -1 },
            { id: 'sc2', title: "Bot Telegram Auto Reply", description: "Bot Telegram tự động trả lời, quản lý đơn hàng, gửi thông báo thanh toán.", price: "300.000đ", priceVal: 300000, icon: <IconSend className="w-8 h-8 text-blue-400" />, color: "from-blue-500 to-indigo-600", features: ["Python/Node.js", "Auto Reply", "Order Management", "Payment Notification"], demoLink: "#", quantity: -1 },
            { id: 'sc3', title: "Landing Page Template", description: "Template Landing Page đẹp mắt, responsive, tối ưu SEO cho mọi ngành nghề.", price: "200.000đ", priceVal: 200000, icon: <IconFileCode className="w-8 h-8 text-purple-400" />, color: "from-purple-500 to-pink-600", features: ["HTML/CSS/JS", "SEO Optimized", "Mobile First", "Easy Customize"], demoLink: "#", quantity: -1 },
            { id: 'sc4', title: "Yêu Cầu Custom Project", description: "Nhận làm dự án theo yêu cầu: Website, App, Bot, Tool tự động hóa...", price: "Liên hệ", priceVal: 0, icon: <IconHelpCircle className="w-8 h-8 text-amber-400" />, color: "from-amber-500 to-orange-500", features: ["Tư vấn miễn phí", "Báo giá nhanh", "Hỗ trợ kỹ thuật"], isContact: true, quantity: 999 }
        ];

        const STATS = [
            { icon: <IconUsers />, value: "10,000+", label: "Học viên", color: "from-cyan-400 to-blue-500" },
            { icon: <IconBookOpen />, value: "50+", label: "Bộ đề", color: "from-purple-400 to-pink-500" },
            { icon: <IconAward />, value: "99%", label: "Hài lòng", color: "from-amber-400 to-orange-500" },
            { icon: <IconClock />, value: "24/7", label: "Hỗ trợ", color: "from-emerald-400 to-teal-500" }
        ];

        const FEATURES = [
            { icon: <IconShield />, title: "Bảo mật tuyệt đối", description: "Thông tin được mã hóa và bảo vệ an toàn", color: "from-cyan-500 to-blue-500" },
            { icon: <IconZap />, title: "Kích hoạt tức thì", description: "Nhận tài liệu ngay sau khi thanh toán", color: "from-amber-500 to-orange-500" },
            { icon: <IconGift />, title: "Ưu đãi hấp dẫn", description: "Giảm giá lên đến 50% cho học viên mới", color: "from-purple-500 to-pink-500" },
            { icon: <IconHeart />, title: "Hỗ trợ tận tâm", description: "Đội ngũ support nhiệt tình 24/7", color: "from-rose-500 to-red-500" }
        ];

        const SOCIAL_LINKS = [
            { name: "Zalo", url: "https://zalo.me/0365297935", color: "from-blue-500 to-blue-600", icon: <IconZalo className="w-5 h-5 fill-current" /> },
            { name: "Facebook", url: "https://www.facebook.com/ngtu.ong14.11", color: "from-blue-600 to-blue-800", icon: <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg> },
            { name: "Telegram", url: "https://t.me/@AstraMindquiz", color: "from-cyan-400 to-blue-500", icon: <IconSend className="w-6 h-6" /> }
        ];

        const DEFAULT_REVIEWS = [];

        const LEGAL_PAGES = {
            terms: { title: "Điều Khoản Sử Dụng", icon: <IconScale className="w-6 h-6" />, content: `<h3>1. Giới Thiệu</h3><p>Chào mừng bạn đến với AstroMind. Bằng việc sử dụng dịch vụ của chúng tôi, bạn đồng ý tuân thủ các điều khoản sau.</p><h3>2. Quyền Sở Hữu Trí Tuệ</h3><p>Tất cả nội dung trên website bao gồm đề thi, tài liệu, hình ảnh đều thuộc quyền sở hữu của AstroMind hoặc các đối tác.</p><h3>3. Quy Định Sử Dụng</h3><ul><li>Không được chia sẻ tài khoản cho người khác</li><li>Không được sao chép, phát tán tài liệu</li><li>Sử dụng đúng mục đích học tập</li></ul>` },
            privacy: { title: "Chính Sách Bảo Mật", icon: <IconLock className="w-6 h-6" />, content: `<h3>1. Thông Tin Thu Thập</h3><p>Chúng tôi thu thập thông tin cần thiết để cung cấp dịch vụ bao gồm: Họ tên, Email, Số điện thoại.</p><h3>2. Mục Đích Sử Dụng</h3><ul><li>Xử lý đơn hàng và giao dịch</li><li>Liên hệ hỗ trợ khách hàng</li><li>Gửi thông báo về đơn hàng</li></ul><h3>3. Bảo Mật Thông Tin</h3><p>Chúng tôi cam kết bảo mật thông tin của bạn và không chia sẻ cho bên thứ ba.</p>` },
            refund: { title: "Chính Sách Hoàn Tiền", icon: <IconRotateCcw className="w-6 h-6" />, content: `<h3>1. Điều Kiện Hoàn Tiền</h3><p>AstroMind cam kết hoàn tiền trong các trường hợp sau:</p><ul><li>Sản phẩm không đúng mô tả</li><li>Lỗi kỹ thuật từ phía hệ thống</li><li>Thanh toán trùng lặp</li></ul><h3>2. Quy Trình Hoàn Tiền</h3><p>Liên hệ với chúng tôi trong vòng 24h kể từ khi phát sinh vấn đề. Hoàn tiền sẽ được xử lý trong 3-5 ngày làm việc.</p><h3>3. Không Áp Dụng Hoàn Tiền</h3><ul><li>Đã sử dụng sản phẩm</li><li>Yêu cầu sau 24h</li><li>Vi phạm điều khoản sử dụng</li></ul>` }
        };

        // --- HELPER FUNCTIONS ---
        const isValidGmail = (email) => /^[a-zA-Z0-9._%+-]+@gmail\.com$/i.test(email);
        const isValidEmail = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        const isValidPhone = (phone) => /^(0[3|5|7|8|9])+([0-9]{8})$/.test(phone.replace(/\D/g, ''));
        const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN').format(amount) + 'đ';
        const formatDate = (dateStr) => { if (!dateStr) return ''; const date = new Date(dateStr); return date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }); };

        // --- COMPONENTS ---
        const ParticleField = memo(() => { const canvasRef = useRef(null); useEffect(() => { const canvas = canvasRef.current; if (!canvas) return; const ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight; const particles = []; const colors = ['#06b6d4', '#8b5cf6', '#ec4899', '#10b981', '#f59e0b']; const isMobile = window.innerWidth < 768; const particleCount = isMobile ? 30 : 80; for (let i = 0; i < particleCount; i++) { particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2 + 0.5, speedX: (Math.random() - 0.5) * 0.5, speedY: (Math.random() - 0.5) * 0.5, opacity: Math.random() * 0.5 + 0.2, color: colors[Math.floor(Math.random() * colors.length)] }); } let animationId; const animate = () => { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach((p) => { p.x += p.speedX; p.y += p.speedY; if (p.x < 0) p.x = canvas.width; if (p.x > canvas.width) p.x = 0; if (p.y < 0) p.y = canvas.height; if (p.y > canvas.height) p.y = 0; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fillStyle = p.color; ctx.globalAlpha = p.opacity; ctx.fill(); }); ctx.globalAlpha = 1; animationId = requestAnimationFrame(animate); }; animate(); const handleResize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }; window.addEventListener('resize', handleResize); return () => { cancelAnimationFrame(animationId); window.removeEventListener('resize', handleResize); }; }, []); return <canvas ref={canvasRef} className="fixed inset-0 z-0 pointer-events-none" />; });
        const ShootingStars = memo(() => { const [stars, setStars] = useState([]); useEffect(() => { const interval = setInterval(() => { const newStar = { id: Date.now(), top: Math.random() * 50 + "%", left: Math.random() * 100 + "%", delay: Math.random() * 2 + "s" }; setStars(prev => [...prev, newStar]); setTimeout(() => { setStars(prev => prev.filter(star => star.id !== newStar.id)); }, 4000); }, 2000); return () => clearInterval(interval); }, []); return (<div className="fixed inset-0 z-0 pointer-events-none overflow-hidden star-shooting">{stars.map(star => (<span key={star.id} style={{ top: star.top, left: star.left, animationDelay: star.delay }} />))}</div>); });
        const RevealOnScroll = ({ children, delay = 0 }) => { const [isVisible, setIsVisible] = useState(false); const ref = useRef(null); useEffect(() => { const observer = new IntersectionObserver(([entry]) => { if (entry.isIntersecting) setIsVisible(true); }, { threshold: 0.1 }); if (ref.current) observer.observe(ref.current); return () => observer.disconnect(); }, []); return (<div ref={ref} className={`transition-all duration-1000 transform ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10'}`} style={{ transitionDelay: `${delay}ms` }}>{children}</div>); };
        const GlassCard = ({ children, className = "", hover = true }) => (<div className={`glass-card relative backdrop-blur-2xl bg-white/[0.03] border border-white/10 rounded-[2.5rem] overflow-hidden shadow-[0_8px_32px_0_rgba(31,38,135,0.37)] ${hover ? 'hover:bg-white/[0.08] hover:border-white/20 hover:shadow-cyan-500/20 transition-all duration-500 hover:-translate-y-2' : ''} ${className}`}><div className="absolute inset-0 bg-gradient-to-br from-white/[0.05] to-transparent pointer-events-none" />{children}</div>);
        const MagneticButton = ({ children, className = "", onClick }) => { const buttonRef = useRef(null); const [position, setPosition] = useState({ x: 0, y: 0 }); const handleMouseMove = (e) => { if (!buttonRef.current) return; const rect = buttonRef.current.getBoundingClientRect(); setPosition({ x: (e.clientX - rect.left - rect.width / 2) * 0.2, y: (e.clientY - rect.top - rect.height / 2) * 0.2 }); }; const handleMouseLeave = () => setPosition({ x: 0, y: 0 }); return (<button ref={buttonRef} onClick={onClick} onMouseMove={handleMouseMove} onMouseLeave={handleMouseLeave} className={`transform transition-transform duration-300 ${className}`} style={{ transform: `translate(${position.x}px, ${position.y}px)` }}>{children}</button>); };
        const AnimatedCounter = ({ end, duration = 2000 }) => { const [count, setCount] = useState(0); const ref = useRef(null); const [isVisible, setIsVisible] = useState(false); useEffect(() => { const observer = new IntersectionObserver(([entry]) => { if (entry.isIntersecting) setIsVisible(true); }); if (ref.current) observer.observe(ref.current); return () => observer.disconnect(); }, []); useEffect(() => { if (!isVisible) return; let startTime; const animate = (currentTime) => { if (!startTime) startTime = currentTime; const progress = Math.min((currentTime - startTime) / duration, 1); setCount(Math.floor(progress * end)); if (progress < 1) requestAnimationFrame(animate); }; requestAnimationFrame(animate); }, [isVisible, end, duration]); return <span ref={ref}>{count.toLocaleString()}</span>; };
        const StockBadge = ({ quantity }) => { if (quantity === -1) return <span className="text-xs text-gray-500 flex items-center gap-1"><IconLoader className="w-3 h-3 animate-spin" /> Đang tải...</span>; if (quantity === 0) return <span className="text-xs text-red-400 font-bold">Hết hàng</span>; if (quantity <= 5) return <span className="text-xs text-orange-400">Còn {quantity} sản phẩm</span>; return <span className="text-xs text-green-400">Còn hàng</span>; };
        const SearchBar = ({ searchTerm, setSearchTerm, placeholder, accentColor = "cyan" }) => { const colorClasses = { cyan: "focus:border-cyan-500 focus:ring-cyan-500/20", purple: "focus:border-purple-500 focus:ring-purple-500/20" }; return (<div className="relative w-full md:w-80"><IconSearch className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" /><input type="text" placeholder={placeholder} value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className={`w-full pl-12 pr-4 py-3 bg-white/5 border border-white/10 rounded-2xl text-white placeholder-gray-500 outline-none transition-all ${colorClasses[accentColor]} focus:ring-4 focus:bg-white/10`} />{searchTerm && (<button onClick={() => setSearchTerm('')} className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white"><IconX className="w-4 h-4" /></button>)}</div>); };
        const LegalModal = ({ isOpen, onClose, pageKey }) => { if (!isOpen || !pageKey) return null; const page = LEGAL_PAGES[pageKey]; if (!page) return null; return (<div className="modal-overlay" onClick={onClose}><div className="modal-content" onClick={(e) => e.stopPropagation()}><GlassCard className="p-6 md:p-8" hover={false}><div className="flex items-center justify-between mb-6 pb-4 border-b border-white/10"><div className="flex items-center gap-3"><div className="p-2 rounded-xl bg-cyan-500/20 text-cyan-400">{page.icon}</div><h2 className="text-xl md:text-2xl font-bold text-white">{page.title}</h2></div><button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-gray-400 hover:text-white transition-colors"><IconX className="w-6 h-6" /></button></div><div className="legal-content max-h-[60vh] overflow-y-auto pr-2 scrollbar-hide" dangerouslySetInnerHTML={{ __html: page.content }} /><div className="mt-6 pt-4 border-t border-white/10 text-center"><button onClick={onClose} className="px-6 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-full text-white font-medium transition-colors">Đã hiểu</button></div></GlassCard></div></div>); };
        const SearchLoadingModal = ({ isOpen }) => { if (!isOpen) return null; return (<div className="search-loading-modal"><div className="flex flex-col items-center gap-6"><div className="relative w-24 h-24"><div className="absolute inset-0 rounded-full border-4 border-cyan-500/30"></div><div className="absolute inset-0 rounded-full border-4 border-transparent border-t-cyan-500 animate-spin"></div><div className="absolute inset-2 rounded-full border-4 border-transparent border-t-purple-500 animate-spin" style={{ animationDuration: '0.8s', animationDirection: 'reverse' }}></div><div className="absolute inset-4 rounded-full border-4 border-transparent border-t-pink-500 animate-spin" style={{ animationDuration: '0.6s' }}></div><div className="absolute inset-0 flex items-center justify-center"><IconSearch className="w-8 h-8 text-cyan-400" /></div></div><div className="text-center"><p className="text-xl font-bold text-white mb-2">Đang tìm kiếm...</p><p className="text-gray-400 text-sm">Vui lòng chờ trong giây lát</p></div><div className="flex gap-2">{[0, 1, 2].map(i => (<div key={i} className="w-3 h-3 rounded-full bg-cyan-500" style={{ animation: 'bounce 0.6s infinite', animationDelay: `${i * 0.15}s` }} />))}</div></div></div>); };
        const CopyButton = ({ text, className = "" }) => { const [copied, setCopied] = useState(false); const handleCopy = async () => { try { await navigator.clipboard.writeText(text); setCopied(true); setTimeout(() => setCopied(false), 2000); } catch (err) { const textArea = document.createElement('textarea'); textArea.value = text; document.body.appendChild(textArea); textArea.select(); document.execCommand('copy'); document.body.removeChild(textArea); setCopied(true); setTimeout(() => setCopied(false), 2000); } }; return (<button onClick={handleCopy} className={`copy-btn p-1.5 rounded-lg transition-all ${copied ? 'bg-green-500/20 text-green-400' : 'bg-white/10 hover:bg-white/20 text-cyan-400 hover:text-cyan-300'} ${className}`} title={copied ? "Đã sao chép!" : "Sao chép"}>{copied ? (<IconCheckCircle className="w-4 h-4" />) : (<IconCopy className="w-4 h-4" />)}</button>); };
        const UniversityTags = ({ universityIds }) => { if (!universityIds || universityIds.length === 0) return null; const unis = universityIds.map(id => UNIVERSITIES.find(u => u.id === id)).filter(Boolean); return (<div className="flex flex-wrap gap-1.5 mt-2">{unis.slice(0, 3).map((uni) => (<span key={uni.id} className="university-tag px-2 py-0.5 rounded-full text-[10px] font-medium text-white flex items-center gap-1"><IconBuilding className="w-2.5 h-2.5" />{uni.name}</span>))}{unis.length > 3 && (<span className="px-2 py-0.5 rounded-full text-[10px] font-medium bg-gray-700/50 text-gray-400 border border-gray-600">+{unis.length - 3}</span>)}</div>); };
        const SkeletonCard = () => (<div className="glass-card relative backdrop-blur-2xl bg-white/[0.03] border border-white/10 rounded-[2.5rem] overflow-hidden"><div className="course-image-container skeleton"></div><div className="p-5 space-y-3"><div className="flex justify-between"><div className="h-4 w-16 skeleton rounded"></div><div className="h-4 w-20 skeleton rounded"></div></div><div className="h-6 w-3/4 skeleton rounded"></div><div className="h-4 w-full skeleton rounded"></div><div className="h-4 w-2/3 skeleton rounded"></div><div className="flex gap-2 pt-3"><div className="h-10 flex-1 skeleton rounded-full"></div><div className="h-10 flex-1 skeleton rounded-full"></div></div></div></div>);
        const AffiliateCodeInput = ({ value, onChange, onValidate, isValid, isChecking, error }) => (<div className="space-y-2"><label className="block text-sm font-medium text-gray-300 flex items-center gap-2"><IconTicket className="w-4 h-4 text-amber-400" />Mã giới thiệu (không bắt buộc)</label><div className="relative"><input type="text" placeholder="Nhập mã giới thiệu nếu có..." value={value} onChange={(e) => onChange(e.target.value.toUpperCase())} onBlur={onValidate} className={`w-full bg-black/30 border rounded-2xl p-3 pr-12 outline-none text-white uppercase tracking-wider ${isChecking ? 'aff-input-checking border-yellow-500/50' : isValid === true ? 'aff-input-valid' : isValid === false ? 'aff-input-invalid' : 'border-gray-700 focus:border-cyan-500'}`} maxLength={20} /><div className="absolute right-3 top-1/2 -translate-y-1/2">{isChecking && <IconLoader className="w-5 h-5 text-yellow-400 animate-spin" />}{!isChecking && isValid === true && <IconCheckCircle className="w-5 h-5 text-green-400" />}{!isChecking && isValid === false && <IconX className="w-5 h-5 text-red-400" />}</div></div>{isValid === true && (<p className="text-xs text-green-400 flex items-center gap-1"><IconCheckCircle className="w-3 h-3" />Mã giới thiệu hợp lệ! Cảm ơn bạn đã sử dụng.</p>)}{isValid === false && error && (<p className="text-xs text-red-400 flex items-center gap-1"><IconAlertCircle className="w-3 h-3" />{error}</p>)}<p className="text-[10px] text-gray-500">Người giới thiệu sẽ nhận 20% hoa hồng từ đơn hàng này.</p></div>);
        const PackageSelector = ({ selectedPackage, onSelect, packageStock, isLoading }) => { const packages = Object.values(PACKAGE_CONFIG); const isPackageSoldOut = (pkg) => { if (!packageStock || isLoading) return false; const stock = packageStock[pkg.stockKey]; return stock !== undefined && stock === 0; }; const getPackageStock = (pkg) => { if (!packageStock || isLoading) return -1; return packageStock[pkg.stockKey]; }; return (<div className="space-y-3"><label className="block text-sm font-medium text-gray-300 mb-3">Chọn gói sản phẩm:</label><div className="grid grid-cols-1 sm:grid-cols-2 gap-3">{packages.map((pkg) => { const soldOut = isPackageSoldOut(pkg); const stock = getPackageStock(pkg); return (<div key={pkg.id} onClick={() => !soldOut && onSelect(pkg)} className={`package-card relative p-4 rounded-2xl border cursor-pointer transition-all ${soldOut ? 'sold-out opacity-60 cursor-not-allowed bg-gray-800/50 border-gray-700' : selectedPackage?.id === pkg.id ? 'selected border-cyan-500/80 bg-cyan-500/10' : pkg.popular ? 'popular border-purple-500/30 bg-white/5 hover:bg-white/10' : pkg.bestValue ? 'border-amber-500/30 bg-white/5 hover:bg-white/10' : 'border-white/10 bg-white/5 hover:bg-white/10'}`}>{soldOut && (<div className="absolute inset-0 flex items-center justify-center bg-black/40 rounded-2xl z-10"><span className="px-2 py-1 bg-red-600 text-white text-xs font-bold rounded">HẾT HÀNG</span></div>)}{pkg.popular && !soldOut && (<span className="absolute -top-2 -right-2 px-2 py-0.5 text-[10px] font-bold bg-purple-500 text-white rounded-full">PHỔ BIẾN</span>)}{pkg.bestValue && !soldOut && (<span className="absolute -top-2 -right-2 px-2 py-0.5 text-[10px] font-bold bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-full">TIẾT KIỆM</span>)}<div className="flex items-start gap-3"><div className={`p-2 rounded-xl bg-gradient-to-br ${pkg.color} text-white shrink-0 ${soldOut ? 'grayscale' : ''}`}>{pkg.icon}</div><div className="flex-1 min-w-0"><div className="flex items-center justify-between gap-2"><h4 className={`font-bold text-sm truncate ${soldOut ? 'text-gray-500' : 'text-white'}`}>{pkg.name}</h4><div className="text-right shrink-0"><span className={`font-bold ${soldOut ? 'text-gray-500' : 'text-cyan-400'}`}>{pkg.priceDisplay}</span>{pkg.originalPrice && (<span className="text-xs text-gray-500 line-through ml-1">{pkg.originalPrice}</span>)}</div></div><p className={`text-xs mt-1 ${soldOut ? 'text-gray-600' : 'text-gray-400'}`}>{pkg.description}</p>{stock > 0 && stock <= 5 && !soldOut && (<p className="text-[10px] text-orange-400 mt-1">Chỉ còn {stock}</p>)}</div></div>{selectedPackage?.id === pkg.id && !soldOut && (<div className="absolute top-2 left-2"><IconCheckCircle className="w-5 h-5 text-cyan-400 fill-cyan-400/20" /></div>)}</div>); })}</div></div>); };

        const CourseCard = ({ course, index, onBuy, isLoadingStock }) => { const [isHovered, setIsHovered] = useState(false); const [showPackages, setShowPackages] = useState(false); const [selectedPackage, setSelectedPackage] = useState(null); const [imageLoaded, setImageLoaded] = useState(false); const badgeColors = { "Bestseller": "from-amber-500 to-orange-500", "Hot": "from-red-500 to-pink-500", "Premium": "from-purple-500 to-indigo-500" }; const isAllPackagesSoldOut = useMemo(() => { if (!course.packageStock) return false; return Object.values(course.packageStock).every(stock => stock === 0); }, [course.packageStock]); const isSoldOut = isAllPackagesSoldOut; const isLoading = course.quantity === -1; const handleBuyClick = () => { if (selectedPackage) { onBuy(course, selectedPackage); } }; const optimizedImage = optimizeImageUrl(course.image, 600, 80); return (<RevealOnScroll delay={index * 150}><GlassCard className="group h-full flex flex-col"><div className={`course-image-container rounded-t-[2.5rem] ${isSoldOut ? 'sold-out-overlay' : ''}`} onMouseEnter={() => setIsHovered(true)} onMouseLeave={() => setIsHovered(false)}><div className="absolute inset-0 bg-gradient-to-t from-[#050B14] via-transparent to-transparent z-10" />{!imageLoaded && <div className="absolute inset-0 skeleton" />}<img src={optimizedImage} alt={course.title} loading="lazy" onLoad={() => setImageLoaded(true)} className={`absolute inset-0 w-full h-full object-cover transition-all duration-700 ${isHovered && !isSoldOut ? 'scale-110 blur-sm' : 'scale-100'} ${isSoldOut ? 'grayscale opacity-60' : ''} ${imageLoaded ? 'opacity-100' : 'opacity-0'}`} />{!isSoldOut && !isLoading && (<a href={course.trialLink} target="_blank" rel="noopener noreferrer" className={`absolute inset-0 flex items-center justify-center z-20 transition-opacity duration-300 ${isHovered ? 'opacity-100' : 'opacity-0'}`}><div className="w-14 h-14 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center cursor-pointer border border-white/30 hover:bg-white/30 transition-colors"><IconFileEdit className="w-5 h-5 text-white" /></div></a>)}<div className="absolute bottom-3 left-3 z-20 flex flex-wrap gap-2">{course.badge && !isSoldOut && (<span className={`px-2 py-0.5 rounded-full text-[10px] font-bold text-white bg-gradient-to-r ${badgeColors[course.badge]} shadow-lg`}>{course.badge}</span>)}</div><div className="absolute top-3 right-3 z-20"><span className="px-2 py-1 rounded-lg text-xs font-medium bg-black/50 backdrop-blur-md text-white border border-white/10">{course.questionCount} câu hỏi</span></div></div><div className="p-5 flex-1 flex flex-col"><div className="flex items-center justify-between mb-2"><div className="flex items-center gap-1 text-amber-400 text-sm font-bold"><IconStar className="w-4 h-4 fill-current" />{course.rating}</div><span className="text-xs text-gray-400">{course.students.toLocaleString()} học viên</span></div><h3 className={`text-lg font-bold text-white mb-2 transition-colors ${isSoldOut ? 'text-gray-500' : 'group-hover:text-cyan-400'}`}>{course.title}</h3><p className="text-gray-400 text-sm mb-2 flex-1 line-clamp-2">{course.description}</p><UniversityTags universityIds={course.universities} /><div className="mb-4 mt-3"><div className="flex flex-wrap gap-2 text-xs"><span className="px-2 py-1 rounded-full bg-blue-500/20 text-blue-400 border border-blue-500/30">PDF: 30k</span><span className="px-2 py-1 rounded-full bg-green-500/20 text-green-400 border border-green-500/30">Quiz: từ 6k</span><span className="px-2 py-1 rounded-full bg-purple-500/20 text-purple-400 border border-purple-500/30">Combo: 50k</span></div></div><div className="mb-3">{isSoldOut ? (<span className="text-xs text-red-400 font-bold">Tất cả gói đã hết hàng</span>) : isLoading ? (<span className="text-xs text-gray-500 flex items-center gap-1"><IconLoader className="w-3 h-3 animate-spin" /> Đang tải...</span>) : (<span className="text-xs text-green-400">Còn hàng</span>)}</div>{!showPackages ? (<div className="flex gap-2 pt-3 border-t border-white/10">{!isSoldOut && !isLoading && course.trialLink && (<a href={course.trialLink} target="_blank" rel="noopener noreferrer" className="flex-1 px-4 py-2.5 rounded-full bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white font-medium flex items-center justify-center gap-2 transition-all text-sm" title="Làm thử miễn phí"><IconFileEdit className="w-4 h-4" />Làm thử</a>)}<button onClick={() => !isSoldOut && !isLoading && setShowPackages(true)} disabled={isSoldOut || isLoading} className={`flex-1 px-4 py-2.5 rounded-full font-medium flex items-center justify-center gap-2 transition-all text-sm ${isSoldOut ? 'bg-gray-800 text-gray-500 cursor-not-allowed border border-gray-700' : isLoading ? 'bg-gray-700 text-gray-400 cursor-wait' : 'bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white shadow-lg shadow-cyan-500/20'}`}>{isSoldOut ? 'Hết hàng' : isLoading ? <IconLoader className="w-4 h-4 animate-spin" /> : (<><IconShoppingCart className="w-4 h-4" />Mua ngay</>)}</button></div>) : (<div className="pt-3 border-t border-white/10 space-y-3"><PackageSelector selectedPackage={selectedPackage} onSelect={setSelectedPackage} packageStock={course.packageStock} isLoading={isLoadingStock} /><div className="flex gap-2"><button onClick={() => { setShowPackages(false); setSelectedPackage(null); }} className="px-4 py-2 rounded-full bg-gray-700 hover:bg-gray-600 text-white text-sm">Hủy</button><button onClick={handleBuyClick} disabled={!selectedPackage} className={`flex-1 px-4 py-2 rounded-full font-medium text-sm transition-all ${selectedPackage ? 'bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white' : 'bg-gray-700 text-gray-500 cursor-not-allowed'}`}>{selectedPackage ? `Mua ${selectedPackage.priceDisplay}` : 'Chọn gói'}</button></div></div>)}</div></GlassCard></RevealOnScroll>); };
        const AccountCard = ({ account, index, onBuy }) => { const [isSubmitting, setIsSubmitting] = useState(false); const isSoldOut = account.quantity === 0; const isLoading = account.quantity === -1; const handleBuyWithFeedback = () => { if (isSoldOut || isLoading || isSubmitting) return; setIsSubmitting(true); setTimeout(() => { onBuy(account, null); setIsSubmitting(false); }, 100); }; return (<RevealOnScroll delay={index * 100}><GlassCard className={`group h-full flex flex-col p-6 ${isSoldOut ? 'opacity-60' : ''}`}><div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${account.color} flex items-center justify-center text-white mb-4 shadow-lg ${isSoldOut ? 'grayscale' : ''}`}>{account.icon}</div><h3 className={`text-xl font-bold text-white mb-1 ${isSoldOut ? 'text-gray-400' : ''}`}>{account.title}</h3><p className="text-xs font-medium mb-3 text-gray-400 uppercase">{account.platform}</p><p className="text-gray-400 text-sm mb-4 flex-1">{account.description}</p>{!account.isContact && (<div className="mb-3"><StockBadge quantity={account.quantity} /></div>)}<div className="flex items-center justify-between pt-4 border-t border-white/10 mt-auto"><span className={`text-xl font-bold ${isSoldOut ? 'text-gray-500' : (account.isContact ? 'text-amber-400' : 'text-white')}`}>{account.price}</span><button onClick={handleBuyWithFeedback} disabled={isSoldOut || isLoading || isSubmitting} className={`px-5 py-2.5 rounded-full font-medium flex items-center gap-2 ${isSoldOut ? 'bg-gray-800 text-gray-500 cursor-not-allowed border border-white/10' : isLoading ? 'bg-gray-700 text-gray-400 cursor-wait' : isSubmitting ? 'bg-gray-600 text-gray-300 cursor-wait' : account.isContact ? 'bg-amber-600 hover:bg-amber-500 shadow-amber-600/20' : `bg-gradient-to-r ${account.color} hover:opacity-90 shadow-lg`} text-white shadow-md transition-all`}>{account.isContact ? <IconPhone size={16} /> : isSoldOut ? null : (isLoading || isSubmitting) ? <IconLoader size={16} className="animate-spin" /> : <IconShoppingCart size={16} />}{isSoldOut ? 'Hết hàng' : (isLoading || isSubmitting) ? 'Đang xử lý...' : (account.isContact ? 'Liên hệ' : 'Mua')}</button></div></GlassCard></RevealOnScroll>); };
        const SourceCodeCard = ({ item, index, onBuy }) => { const [isSubmitting, setIsSubmitting] = useState(false); const isSoldOut = item.quantity === 0; const isLoading = item.quantity === -1; const handleBuyWithFeedback = () => { if (isSoldOut || isLoading || isSubmitting) return; setIsSubmitting(true); setTimeout(() => { onBuy(item, null); setIsSubmitting(false); }, 100); }; return (<RevealOnScroll delay={index * 100}><GlassCard className={`group h-full flex flex-col p-6 ${isSoldOut ? 'opacity-60' : ''}`}><div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${item.color} flex items-center justify-center text-white mb-4 shadow-lg ${isSoldOut ? 'grayscale' : ''}`}>{item.icon}</div><h3 className={`text-xl font-bold text-white mb-2 ${isSoldOut ? 'text-gray-400' : ''}`}>{item.title}</h3><p className="text-gray-400 text-sm mb-4 flex-1">{item.description}</p><div className="flex flex-wrap gap-2 mb-4">{item.features.map((f, i) => (<span key={i} className="px-2 py-1 text-xs rounded-full bg-white/5 text-gray-300 border border-white/10">{f}</span>))}</div>{!item.isContact && (<div className="mb-3"><StockBadge quantity={item.quantity} /></div>)}<div className="flex items-center justify-between pt-4 border-t border-white/10 mt-auto"><span className={`text-xl font-bold ${isSoldOut ? 'text-gray-500' : (item.isContact ? 'text-amber-400' : 'text-white')}`}>{item.price}</span><div className="flex gap-2">{item.demoLink && !item.isContact && (<a href={item.demoLink} target="_blank" rel="noopener noreferrer" className="px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center gap-1 text-sm transition-colors"><IconExternalLink size={14} />Demo</a>)}<button onClick={handleBuyWithFeedback} disabled={isSoldOut || isLoading || isSubmitting} className={`px-5 py-2 rounded-full font-medium flex items-center gap-2 text-sm ${isSoldOut ? 'bg-gray-800 text-gray-500 cursor-not-allowed' : isLoading ? 'bg-gray-700 text-gray-400 cursor-wait' : isSubmitting ? 'bg-gray-600 text-gray-300 cursor-wait' : item.isContact ? 'bg-amber-600 hover:bg-amber-500' : `bg-gradient-to-r ${item.color} hover:opacity-90`} text-white transition-all`}>{item.isContact ? <IconPhone size={14} /> : isSoldOut ? null : (isLoading || isSubmitting) ? <IconLoader size={14} className="animate-spin" /> : <IconShoppingCart size={14} />}{isSoldOut ? 'Hết' : (isLoading || isSubmitting) ? '...' : (item.isContact ? 'Liên hệ' : 'Mua')}</button></div></div></GlassCard></RevealOnScroll>); };
        const ReviewCard = ({ review }) => (<GlassCard className="w-[320px] md:w-[380px] shrink-0 mx-3 p-6" hover={false}><div className="flex justify-between items-start mb-4"><div className="flex gap-1 text-amber-400">{[...Array(5)].map((_, i) => <IconStar key={i} size={14} className={i < (review.rating || 5) ? "fill-current" : "text-gray-600"} />)}</div><span className="text-[10px] uppercase font-bold px-3 py-1 rounded-full bg-cyan-900/30 text-cyan-400 border border-cyan-500/30">{review.type || "Thành viên"}</span></div><p className="text-gray-300 italic text-sm line-clamp-3 mb-4">"{review.content}"</p><div className="flex items-center gap-3 pt-4 border-t border-white/10"><div className="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white font-bold">{review.name?.charAt(0)}</div><div><h4 className="text-white font-bold text-sm">{review.name}</h4><p className="text-cyan-500 text-xs flex items-center gap-1"><IconCheckCircle size={12} className="fill-current" /> Đã xác thực</p></div></div></GlassCard>);

        // ============================================
        // AFFILIATE SECTION COMPONENT - ĐÃ THÊM "CÁCH THỨC HOẠT ĐỘNG"
        // ============================================
        const AffiliateSection = () => {
            const [activeTab, setActiveTab] = useState('register');
            const [registerForm, setRegisterForm] = useState({ name: '', email: '', phone: '', bankName: '', bankAccount: '', bankAccountName: '' });
            const [registerError, setRegisterError] = useState('');
            const [registerSuccess, setRegisterSuccess] = useState(null);
            const [isRegistering, setIsRegistering] = useState(false);
            const [checkForm, setCheckForm] = useState({ code: '', phone: '' });
            const [checkError, setCheckError] = useState('');
            const [commissionData, setCommissionData] = useState(null);
            const [isChecking, setIsChecking] = useState(false);

            const handleRegisterChange = (e) => { const { name, value } = e.target; if (name === 'phone' || name === 'bankAccount') { setRegisterForm(prev => ({ ...prev, [name]: value.replace(/\D/g, '') })); } else { setRegisterForm(prev => ({ ...prev, [name]: value })); } };
            const validateRegisterForm = () => { if (!registerForm.name.trim()) return "Vui lòng nhập họ tên."; if (registerForm.name.trim().length < 2) return "Họ tên phải có ít nhất 2 ký tự."; if (!isValidEmail(registerForm.email)) return "Vui lòng nhập email hợp lệ."; if (!isValidPhone(registerForm.phone)) return "Vui lòng nhập số điện thoại hợp lệ (10 số)."; if (!registerForm.bankName) return "Vui lòng chọn ngân hàng."; if (!registerForm.bankAccount || registerForm.bankAccount.length < 6) return "Vui lòng nhập số tài khoản hợp lệ."; if (!registerForm.bankAccountName.trim()) return "Vui lòng nhập tên chủ tài khoản."; return null; };

            const handleRegisterSubmit = async (e) => {
                e.preventDefault(); setRegisterError(''); setRegisterSuccess(null);
                const error = validateRegisterForm(); if (error) { setRegisterError(error); return; }
                setIsRegistering(true);
                try {
                    const response = await fetch(SCRIPT_URL, { method: 'POST', mode: 'cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify({ action: 'register_affiliate', name: registerForm.name, email: registerForm.email, phone: registerForm.phone, bankName: registerForm.bankName, bankAccount: registerForm.bankAccount, bankAccountName: registerForm.bankAccountName }) });
                    const data = await response.json();
                    if (data.result === 'success') { setRegisterSuccess({ code: data.affiliateCode, name: data.name, email: data.email }); setRegisterForm({ name: '', email: '', phone: '', bankName: '', bankAccount: '', bankAccountName: '' }); }
                    else { setRegisterError(data.message || 'Đăng ký thất bại. Vui lòng thử lại.'); }
                } catch (err) { console.error('Register error:', err); setRegisterError('Lỗi kết nối. Vui lòng thử lại sau.'); }
                setIsRegistering(false);
            };

            const handleCheckChange = (e) => { const { name, value } = e.target; if (name === 'phone') { setCheckForm(prev => ({ ...prev, [name]: value.replace(/\D/g, '') })); } else if (name === 'code') { setCheckForm(prev => ({ ...prev, [name]: value.toUpperCase() })); } else { setCheckForm(prev => ({ ...prev, [name]: value })); } };

            const handleCheckSubmit = async (e) => {
                e.preventDefault(); setCheckError(''); setCommissionData(null);
                if (!checkForm.code.trim()) { setCheckError('Vui lòng nhập mã affiliate.'); return; }
                if (!isValidPhone(checkForm.phone)) { setCheckError('Vui lòng nhập số điện thoại hợp lệ.'); return; }
                setIsChecking(true);
                try {
                    const response = await fetch(SCRIPT_URL, { method: 'POST', mode: 'cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify({ action: 'check_affiliate_commission', code: checkForm.code.trim(), phone: checkForm.phone }) });
                    const data = await response.json();
                    if (data.result === 'success') { setCommissionData(data); }
                    else { setCheckError(data.message || 'Không tìm thấy thông tin. Vui lòng kiểm tra lại.'); }
                } catch (err) { console.error('Check commission error:', err); setCheckError('Lỗi kết nối. Vui lòng thử lại sau.'); }
                setIsChecking(false);
            };

            // Data cho phần "Cách Thức Hoạt Động"
            const howItWorksSteps = [
                { step: 1, title: 'Đăng ký', desc: 'Điền thông tin và nhận mã Affiliate', icon: <IconUserPlus className="w-6 h-6" /> },
                { step: 2, title: 'Chia sẻ', desc: 'Gửi mã cho bạn bè, đăng lên MXH', icon: <IconSend className="w-6 h-6" /> },
                { step: 3, title: 'Theo dõi', desc: 'Xem thống kê đơn hàng & hoa hồng', icon: <IconTrendingUp className="w-6 h-6" /> },
                { step: 4, title: 'Nhận tiền', desc: 'Hoa hồng thanh toán hàng tháng', icon: <IconWallet className="w-6 h-6" /> }
            ];

            return (
                <section id="affiliate" className="py-20 px-4 max-w-4xl mx-auto">
                    <RevealOnScroll>
                        <div className="text-center mb-12">
                            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20 mb-4"><IconPercent className="w-5 h-5 text-purple-400" /><span className="text-sm text-purple-400 font-medium">Kiếm tiền cùng AstroMind</span></div>
                            <h2 className="text-3xl md:text-5xl font-bold text-white mb-4">Chương Trình Tiếp Thị Liên Kết</h2>
                            <p className="text-gray-400 max-w-2xl mx-auto">Nhận ngay <span className="text-purple-400 font-bold">20% hoa hồng</span> cho mỗi đơn hàng thành công từ mã giới thiệu của bạn</p>
                            <div className="h-1 w-24 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto rounded-full mt-6" />
                        </div>
                    </RevealOnScroll>

                    {/* Affiliate Benefits */}
                    <RevealOnScroll delay={100}>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div className="stat-card rounded-2xl p-5 text-center"><div className="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center mx-auto mb-3"><IconPercent className="w-6 h-6 text-white" /></div><h4 className="text-white font-bold mb-1">20% Hoa Hồng</h4><p className="text-gray-500 text-sm">Cho mỗi đơn hàng thành công</p></div>
                            <div className="stat-card rounded-2xl p-5 text-center"><div className="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center mx-auto mb-3"><IconTrendingUp className="w-6 h-6 text-white" /></div><h4 className="text-white font-bold mb-1">Không Giới Hạn</h4><p className="text-gray-500 text-sm">Thu nhập không có trần</p></div>
                            <div className="stat-card rounded-2xl p-5 text-center"><div className="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center mx-auto mb-3"><IconWallet className="w-6 h-6 text-white" /></div><h4 className="text-white font-bold mb-1">Thanh Toán Hàng Tháng</h4><p className="text-gray-500 text-sm">Chuyển khoản trực tiếp</p></div>
                        </div>
                    </RevealOnScroll>

                    <RevealOnScroll delay={200}>
                        <GlassCard className="p-6 md:p-8 affiliate-card">
                            {/* Tab Navigation */}
                            <div className="flex gap-2 mb-8 bg-white/5 p-1.5 rounded-2xl">
                                <button onClick={() => { setActiveTab('register'); setCommissionData(null); setCheckError(''); }} className={`flex-1 py-3 px-4 rounded-xl font-medium flex items-center justify-center gap-2 tab-btn ${activeTab === 'register' ? 'active' : 'text-gray-400'}`}><IconUserPlus className="w-5 h-5" />Đăng Ký Affiliate</button>
                                <button onClick={() => { setActiveTab('check'); setRegisterSuccess(null); setRegisterError(''); }} className={`flex-1 py-3 px-4 rounded-xl font-medium flex items-center justify-center gap-2 tab-btn ${activeTab === 'check' ? 'active' : 'text-gray-400'}`}><IconDollarSign className="w-5 h-5" />Kiểm Tra Hoa Hồng</button>
                            </div>

                            {/* Register Tab */}
                            {activeTab === 'register' && (
                                <div className="animate-fade-in">
                                    {registerSuccess ? (
                                        <div className="text-center py-8">
                                            <div className="w-20 h-20 bg-green-500/20 text-green-400 rounded-full flex items-center justify-center mx-auto mb-6"><IconCheckCircle size={40} /></div>
                                            <h3 className="text-2xl font-bold text-white mb-4">Đăng Ký Thành Công!</h3>
                                            <div className="bg-purple-500/10 border border-purple-500/30 rounded-2xl p-6 mb-6"><p className="text-gray-400 mb-2">Mã Affiliate của bạn:</p><div className="flex items-center justify-center gap-3"><span className="text-3xl font-mono font-bold text-purple-400">{registerSuccess.code}</span><CopyButton text={registerSuccess.code} /></div></div>
                                            <div className="bg-white/5 border border-white/10 rounded-xl p-4 text-left mb-6"><h4 className="font-bold text-white mb-2">Cách sử dụng:</h4><ul className="text-sm text-gray-400 space-y-1"><li>• Chia sẻ mã <span className="text-purple-400 font-bold">{registerSuccess.code}</span> cho bạn bè</li><li>• Khách hàng nhập mã khi thanh toán</li><li>• Bạn nhận 20% hoa hồng từ mỗi đơn hàng</li></ul></div>
                                            <p className="text-sm text-gray-500 mb-4">Thông tin đã được gửi đến email <strong className="text-white">{registerSuccess.email}</strong></p>
                                            <button onClick={() => setRegisterSuccess(null)} className="px-6 py-2 bg-purple-600 hover:bg-purple-500 rounded-full text-white font-medium transition-colors">Đăng ký mã khác</button>
                                        </div>
                                    ) : (
                                        <form onSubmit={handleRegisterSubmit} className="space-y-5">
                                            {registerError && (<div className="p-3 bg-red-500/20 border border-red-500/50 rounded-xl flex items-center gap-2 text-red-300 text-sm animate-fade-in-down"><IconAlertCircle className="w-5 h-5 shrink-0" />{registerError}</div>)}
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div><label className="block text-sm font-medium text-gray-300 mb-2">Họ và tên *</label><input required type="text" name="name" placeholder="Nguyễn Văn A" value={registerForm.name} onChange={handleRegisterChange} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white" /></div>
                                                <div><label className="block text-sm font-medium text-gray-300 mb-2">Số điện thoại *</label><input required type="tel" name="phone" placeholder="0901234567" value={registerForm.phone} onChange={handleRegisterChange} maxLength={10} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white" /></div>
                                            </div>
                                            <div><label className="block text-sm font-medium text-gray-300 mb-2">Email *</label><input required type="email" name="email" placeholder="email@example.com" value={registerForm.email} onChange={handleRegisterChange} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white" /></div>
                                            <div className="border-t border-white/10 pt-5">
                                                <h4 className="text-white font-bold mb-4 flex items-center gap-2"><IconCreditCard className="w-5 h-5 text-purple-400" />Thông tin nhận tiền</h4>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div><label className="block text-sm font-medium text-gray-300 mb-2">Ngân hàng *</label><select required name="bankName" value={registerForm.bankName} onChange={handleRegisterChange} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white"><option value="">-- Chọn ngân hàng --</option>{VIETNAM_BANKS.map(bank => (<option key={bank.id} value={bank.name}>{bank.name}</option>))}</select></div>
                                                    <div><label className="block text-sm font-medium text-gray-300 mb-2">Số tài khoản *</label><input required type="text" name="bankAccount" placeholder="Nhập số tài khoản" value={registerForm.bankAccount} onChange={handleRegisterChange} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white" /></div>
                                                </div>
                                                <div className="mt-4"><label className="block text-sm font-medium text-gray-300 mb-2">Tên chủ tài khoản *</label><input required type="text" name="bankAccountName" placeholder="NGUYEN VAN A (viết hoa, không dấu)" value={registerForm.bankAccountName} onChange={handleRegisterChange} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white uppercase" /></div>
                                            </div>
                                            <div className="bg-purple-500/10 border border-purple-500/30 rounded-xl p-4"><p className="text-purple-300 text-sm flex items-start gap-2"><IconGift className="w-5 h-5 shrink-0 mt-0.5" /><span>Sau khi đăng ký, bạn sẽ nhận được mã affiliate riêng qua email. Hoa hồng được thanh toán vào cuối mỗi tháng.</span></p></div>
                                            <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4"><p className="text-amber-300 text-sm flex items-start gap-2"><IconAlertCircle className="w-5 h-5 shrink-0 mt-0.5" /><span><strong>Lưu ý:</strong> Số tiền thanh toán hoa hồng tối thiểu là <strong className="text-amber-400">100.000đ</strong>. Nếu chưa đủ, hoa hồng sẽ được tích lũy sang tháng sau.</span></p></div>
                                            <button type="submit" disabled={isRegistering} className={`w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded-full font-bold text-white transition-all ${isRegistering ? 'opacity-50 cursor-wait' : ''}`}>{isRegistering ? (<><IconLoader className="inline w-5 h-5 animate-spin mr-2" />Đang xử lý...</>) : (<><IconUserPlus className="inline w-5 h-5 mr-2" />Đăng Ký Ngay</>)}</button>
                                        </form>
                                    )}

                                    {/* ★★★ THÊM PHẦN "CÁCH THỨC HOẠT ĐỘNG" Ở ĐÂY ★★★ */}
                                    <div className="mt-12">
                                        <h3 className="text-xl font-bold text-white text-center mb-8">Cách Thức Hoạt Động</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                            {howItWorksSteps.map((item, idx) => (
                                                <div key={idx} className="relative">
                                                    <div className="step-card bg-white/5 border border-white/10 rounded-2xl p-4 text-center h-full">
                                                        <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-amber-500 text-white text-xs font-bold flex items-center justify-center">
                                                            {item.step}
                                                        </div>
                                                        <div className="w-12 h-12 rounded-xl bg-amber-500/10 flex items-center justify-center mx-auto mb-3 mt-2 text-amber-400">
                                                            {item.icon}
                                                        </div>
                                                        <h4 className="font-bold text-white mb-1">{item.title}</h4>
                                                        <p className="text-xs text-gray-400">{item.desc}</p>
                                                    </div>
                                                    {idx < 3 && (
                                                        <div className="hidden md:block absolute top-1/2 -right-2 transform -translate-y-1/2 text-gray-600">
                                                            <IconChevronRight className="w-4 h-4" />
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Check Commission Tab */}
                            {activeTab === 'check' && (
                                <div className="animate-fade-in">
                                    {!commissionData ? (
                                        <form onSubmit={handleCheckSubmit} className="space-y-5">
                                            {checkError && (<div className="p-3 bg-red-500/20 border border-red-500/50 rounded-xl flex items-center gap-2 text-red-300 text-sm animate-fade-in-down"><IconAlertCircle className="w-5 h-5 shrink-0" />{checkError}</div>)}
                                            <div><label className="block text-sm font-medium text-gray-300 mb-2">Mã Affiliate *</label><input required type="text" name="code" placeholder="VD: AFF12345" value={checkForm.code} onChange={handleCheckChange} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white uppercase tracking-wider" maxLength={20} /></div>
                                            <div><label className="block text-sm font-medium text-gray-300 mb-2">Số điện thoại đã đăng ký *</label><input required type="tel" name="phone" placeholder="0901234567" value={checkForm.phone} onChange={handleCheckChange} maxLength={10} className="w-full bg-black/30 border border-gray-700 rounded-xl p-3 outline-none focus:border-purple-500 text-white" /></div>
                                            <button type="submit" disabled={isChecking} className={`w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded-full font-bold text-white transition-all ${isChecking ? 'opacity-50 cursor-wait' : ''}`}>{isChecking ? (<><IconLoader className="inline w-5 h-5 animate-spin mr-2" />Đang kiểm tra...</>) : (<><IconSearch className="inline w-5 h-5 mr-2" />Kiểm Tra Hoa Hồng</>)}</button>
                                        </form>
                                    ) : (
                                        <div className="space-y-6">
                                            <div className="bg-white/5 border border-white/10 rounded-2xl p-5">
                                                <div className="flex items-center gap-4 mb-4"><div className="w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-xl">{commissionData.affiliate?.name?.charAt(0) || 'A'}</div><div><h4 className="text-white font-bold text-lg">{commissionData.affiliate?.name}</h4><p className="text-purple-400 text-sm font-mono">{commissionData.affiliate?.code}</p></div></div>
                                                <div className="grid grid-cols-2 gap-3 text-sm"><div><span className="text-gray-500">Email:</span> <span className="text-white">{commissionData.affiliate?.email}</span></div><div><span className="text-gray-500">Ngân hàng:</span> <span className="text-white">{commissionData.affiliate?.bankName}</span></div><div><span className="text-gray-500">STK:</span> <span className="text-white font-mono">{commissionData.affiliate?.bankAccount}</span></div><div><span className="text-gray-500">Chủ TK:</span> <span className="text-white">{commissionData.affiliate?.bankAccountName}</span></div></div>
                                            </div>
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                                <div className="stat-card rounded-xl p-4 text-center"><p className="text-gray-500 text-xs mb-1">Tổng đơn hàng</p><p className="text-2xl font-bold text-white">{commissionData.stats?.totalOrders || 0}</p></div>
                                                <div className="stat-card rounded-xl p-4 text-center"><p className="text-gray-500 text-xs mb-1">Tổng doanh số</p><p className="text-2xl font-bold text-cyan-400">{formatCurrency(commissionData.stats?.totalSales || 0)}</p></div>
                                                <div className="stat-card rounded-xl p-4 text-center border-green-500/30"><p className="text-gray-500 text-xs mb-1">Chờ thanh toán</p><p className="text-2xl font-bold text-amber-400">{formatCurrency(commissionData.stats?.pendingCommission || 0)}</p></div>
                                                <div className="stat-card rounded-xl p-4 text-center border-green-500/30"><p className="text-gray-500 text-xs mb-1">Đã thanh toán</p><p className="text-2xl font-bold text-green-400">{formatCurrency(commissionData.stats?.paidCommission || 0)}</p></div>
                                            </div>
                                            {commissionData.stats?.recentOrders && commissionData.stats.recentOrders.length > 0 && (
                                                <div>
                                                    <h4 className="text-white font-bold mb-3 flex items-center gap-2"><IconClipboardList className="w-5 h-5 text-purple-400" />Đơn hàng gần đây</h4>
                                                    <div className="overflow-x-auto rounded-xl border border-white/10">
                                                        <table className="commission-table"><thead><tr><th>Ngày</th><th>Mã đơn</th><th>Doanh số</th><th>Hoa hồng</th><th>Trạng thái</th></tr></thead><tbody>{commissionData.stats.recentOrders.map((order, idx) => (<tr key={idx}><td className="text-gray-400 text-sm">{formatDate(order.date)}</td><td className="text-white font-mono text-sm">{order.orderId}</td><td className="text-cyan-400">{formatCurrency(order.saleAmount)}</td><td className="text-green-400 font-bold">{formatCurrency(order.commission)}</td><td><span className={`px-2 py-1 rounded-full text-xs ${order.status === 'Đã thanh toán HH' || order.status === 'Paid' ? 'bg-green-500/20 text-green-400' : order.status === 'Đã hủy' || order.status === 'Cancelled' ? 'bg-red-500/20 text-red-400' : 'bg-amber-500/20 text-amber-400'}`}>{order.status}</span></td></tr>))}</tbody></table>
                                                    </div>
                                                </div>
                                            )}
                                            <button onClick={() => { setCommissionData(null); setCheckForm({ code: '', phone: '' }); }} className="w-full py-3 bg-gray-700 hover:bg-gray-600 rounded-full font-medium text-white transition-colors">Kiểm tra mã khác</button>
                                        </div>
                                    )}
                                </div>
                            )}
                        </GlassCard>
                    </RevealOnScroll>
                </section>
            );
        };

        // --- MAIN APP ---
        function GalaxyShop() {
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [scrolled, setScrolled] = useState(false);
            const [scrollProgress, setScrollProgress] = useState(0);
            const [searchGiuaKi, setSearchGiuaKi] = useState('');
            const [searchCuoiKi, setSearchCuoiKi] = useState('');
            const [giuaKi, setGiuaKi] = useState(GIUAKI_DATA);
            const [cuoiKi, setCuoiKi] = useState(CUOIKI_DATA);
            const [apps, setApps] = useState(ACCOUNTS_DATA);
            const [sourceCode, setSourceCode] = useState(SOURCE_CODE_DATA);
            const [isLoadingStock, setIsLoadingStock] = useState(true);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [selectedPackage, setSelectedPackage] = useState(null);
            const [orderForm, setOrderForm] = useState({ name: '', email: '', phone: '', quantity: 1, affiliateCode: '' });
            const [orderStep, setOrderStep] = useState(1);
            const [searchEmail, setSearchEmail] = useState('');
            const [searchEmailError, setSearchEmailError] = useState('');
            const [myOrders, setMyOrders] = useState(null);
            const [isSearching, setIsSearching] = useState(false);
            const [generatedOrderId, setGeneratedOrderId] = useState('');
            const [orderError, setOrderError] = useState(null);
            const [reviews, setReviews] = useState(DEFAULT_REVIEWS);
            const [fbForm, setFbForm] = useState({ name: '', email: '', message: '', rating: 5, type: 'Mua đề thi' });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [paidKey, setPaidKey] = useState(null);
            const [legalModal, setLegalModal] = useState({ isOpen: false, pageKey: null });
            const [isAffiliateValid, setIsAffiliateValid] = useState(null);
            const [isCheckingAffiliate, setIsCheckingAffiliate] = useState(false);
            const [affiliateError, setAffiliateError] = useState('');

            const sortByStock = (a, b) => { if (a.quantity !== 0 && b.quantity === 0) return -1; if (a.quantity === 0 && b.quantity !== 0) return 1; return 0; };
            const filteredGiuaKi = useMemo(() => { let result = giuaKi; if (searchGiuaKi.trim()) { const term = searchGiuaKi.toLowerCase(); result = giuaKi.filter(item => item.title.toLowerCase().includes(term) || item.subject.toLowerCase().includes(term) || item.tags.some(tag => tag.toLowerCase().includes(term)) || (item.universities && item.universities.some(uniId => { const uni = UNIVERSITIES.find(u => u.id === uniId); return uni && uni.name.toLowerCase().includes(term); }))); } return [...result].sort(sortByStock); }, [giuaKi, searchGiuaKi]);
            const filteredCuoiKi = useMemo(() => { let result = cuoiKi; if (searchCuoiKi.trim()) { const term = searchCuoiKi.toLowerCase(); result = cuoiKi.filter(item => item.title.toLowerCase().includes(term) || item.subject.toLowerCase().includes(term) || item.tags.some(tag => tag.toLowerCase().includes(term)) || (item.universities && item.universities.some(uniId => { const uni = UNIVERSITIES.find(u => u.id === uniId); return uni && uni.name.toLowerCase().includes(term); }))); } return [...result].sort(sortByStock); }, [cuoiKi, searchCuoiKi]);

            useEffect(() => { const handleScroll = () => { setScrolled(window.scrollY > 50); const scrollHeight = document.documentElement.scrollHeight - window.innerHeight; const progress = (window.scrollY / scrollHeight) * 100; setScrollProgress(progress); }; window.addEventListener('scroll', handleScroll); fetchReviews(); fetchInventory(); return () => window.removeEventListener('scroll', handleScroll); }, []);
            useEffect(() => { let interval; if (orderStep === 2 && generatedOrderId) { interval = setInterval(async () => { try { const res = await fetch(`${SCRIPT_URL}?action=check_status&orderId=${generatedOrderId}`); const data = await res.json(); if (data.status === 'paid' && data.key) { setPaidKey(data.key); setOrderStep(3); clearInterval(interval); fetchInventory(); } else if (data.status === 'partial') { setOrderError(`Số tiền chuyển khoản chưa đủ. Vui lòng chuyển thêm ${data.remaining?.toLocaleString('vi-VN')}đ hoặc liên hệ hỗ trợ.`); } } catch (e) { console.error("Polling error", e); } }, 3000); } return () => clearInterval(interval); }, [orderStep, generatedOrderId]);

            const fetchReviews = async () => { try { const res = await fetch(`${SCRIPT_URL}?action=get_reviews`); const data = await res.json(); if (Array.isArray(data)) setReviews(data); } catch (e) { console.error(e); } };

            const fetchInventory = async () => {
                setIsLoadingStock(true);
                try {
                    const res = await fetch(`${SCRIPT_URL}?action=get_products`);
                    if (!res.ok) throw new Error("Server response not ok");
                    const data = await res.json();
                    if (Array.isArray(data) && data.length > 0) {
                        const updateCourseFromSheet = (localList) => localList.map(localItem => { const sheetItem = data.find(i => String(i.id) === String(localItem.id)); if (sheetItem) { const packageStock = { pdf: sheetItem.pdf !== undefined ? parseInt(sheetItem.pdf) : 999, quiz1: sheetItem.quiz1 !== undefined ? parseInt(sheetItem.quiz1) : 999, quiz6: sheetItem.quiz6 !== undefined ? parseInt(sheetItem.quiz6) : 999, quiz10: sheetItem.quiz10 !== undefined ? parseInt(sheetItem.quiz10) : 999, combo: sheetItem.combo !== undefined ? parseInt(sheetItem.combo) : 999, }; return { ...localItem, quantity: parseInt(sheetItem.quantity) || 999, packageStock }; } return { ...localItem, quantity: 999, packageStock: { pdf: 999, quiz1: 999, quiz6: 999, quiz10: 999, combo: 999 } }; });
                        const updateSimpleFromSheet = (localList) => localList.map(localItem => { if (localItem.isContact) { return { ...localItem, quantity: 999 }; } const sheetItem = data.find(i => String(i.id) === String(localItem.id)); if (sheetItem) { const qty = parseInt(sheetItem.quantity); return { ...localItem, quantity: isNaN(qty) ? 999 : qty }; } return { ...localItem, quantity: 999 }; });
                        setGiuaKi(prev => updateCourseFromSheet(prev)); setCuoiKi(prev => updateCourseFromSheet(prev)); setApps(prev => updateSimpleFromSheet(prev)); setSourceCode(prev => updateSimpleFromSheet(prev));
                    } else { const setDefaultStock = (list, withPackage = false) => list.map(item => ({ ...item, quantity: item.isContact ? 999 : 999, ...(withPackage && { packageStock: { pdf: 999, quiz1: 999, quiz6: 999, quiz10: 999, combo: 999 } }) })); setGiuaKi(prev => setDefaultStock(prev, true)); setCuoiKi(prev => setDefaultStock(prev, true)); setApps(prev => setDefaultStock(prev)); setSourceCode(prev => setDefaultStock(prev)); }
                } catch (e) { console.error("Fetch inventory error:", e); const setDefaultStock = (list, withPackage = false) => list.map(item => ({ ...item, quantity: item.isContact ? 999 : 999, ...(withPackage && { packageStock: { pdf: 999, quiz1: 999, quiz6: 999, quiz10: 999, combo: 999 } }) })); setGiuaKi(prev => setDefaultStock(prev, true)); setCuoiKi(prev => setDefaultStock(prev, true)); setApps(prev => setDefaultStock(prev)); setSourceCode(prev => setDefaultStock(prev)); }
                finally { setIsLoadingStock(false); }
            };

            const validateAffiliateCode = async () => { const code = orderForm.affiliateCode.trim().toUpperCase(); if (!code) { setIsAffiliateValid(null); setAffiliateError(''); return; } setIsCheckingAffiliate(true); setAffiliateError(''); try { const res = await fetch(`${SCRIPT_URL}?action=validate_affiliate&code=${code}`); const data = await res.json(); if (data.valid) { setIsAffiliateValid(true); setAffiliateError(''); } else { setIsAffiliateValid(false); setAffiliateError(data.message || 'Mã giới thiệu không tồn tại hoặc không hợp lệ.'); } } catch (e) { setIsAffiliateValid(false); setAffiliateError('Lỗi kiểm tra mã. Vui lòng thử lại.'); } setIsCheckingAffiliate(false); };

            const handleBuyClick = (product, pkg) => { if (pkg && product.packageStock) { const pkgStock = product.packageStock[pkg.stockKey]; if (pkgStock !== undefined && pkgStock === 0) { alert("Gói này đã hết hàng!"); return; } } else if (product.quantity <= 0) { alert("Sản phẩm này đã hết hàng!"); return; } if(product.isContact) { document.getElementById('lien-he')?.scrollIntoView({ behavior: 'smooth' }); } else { setSelectedProduct(product); setSelectedPackage(pkg); setOrderForm(prev => ({ ...prev, quantity: 1, affiliateCode: '' })); setIsAffiliateValid(null); setAffiliateError(''); setOrderStep(1); setPaidKey(null); setOrderError(null); setTimeout(() => document.getElementById('dat-hang')?.scrollIntoView({ behavior: 'smooth' }), 100); } };
            const validateOrderForm = () => { const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; const phoneRegex = /^(0[3|5|7|8|9])+([0-9]{8})$/; if (!orderForm.name.trim()) return "Vui lòng nhập họ tên."; if (orderForm.name.trim().length < 2) return "Họ tên phải có ít nhất 2 ký tự."; if (!phoneRegex.test(orderForm.phone)) return "Vui lòng nhập số điện thoại hợp lệ (10 số, bắt đầu bằng 03, 05, 07, 08, 09)."; if (!emailRegex.test(orderForm.email)) return "Vui lòng nhập email hợp lệ."; if (orderForm.affiliateCode.trim() && isAffiliateValid === false) { return "Mã giới thiệu không hợp lệ. Vui lòng kiểm tra lại hoặc bỏ trống."; } return null; };
            const handleOrderSubmit = async (e) => { e.preventDefault(); setOrderError(null); const error = validateOrderForm(); if (error) { setOrderError(error); return; } setOrderStep(1.5); };
            const getTotalPrice = () => { if (selectedPackage) { return selectedPackage.price * orderForm.quantity; } if (selectedProduct?.priceVal) { return selectedProduct.priceVal * orderForm.quantity; } return 0; };
            const getProductDisplayName = () => { if (selectedPackage) { return `${selectedProduct?.title} - ${selectedPackage.name}`; } return selectedProduct?.title || ''; };
            const getAffiliateCommission = () => { if (!orderForm.affiliateCode.trim() || isAffiliateValid !== true) return 0; return Math.floor(getTotalPrice() * AFFILIATE_COMMISSION_RATE); };

            const handleConfirmOrder = async () => { setIsSubmitting(true); const newOrderId = "DH" + Math.floor(Math.random() * 100000); setGeneratedOrderId(newOrderId); const totalPrice = getTotalPrice(); const commission = getAffiliateCommission(); try { await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify({ action: 'create_order', orderId: newOrderId, name: orderForm.name, email: orderForm.email, phone: orderForm.phone, product: getProductDisplayName(), productId: selectedProduct?.id, packageId: selectedPackage?.id || 'app', price: totalPrice, quantity: orderForm.quantity, expectedAmount: totalPrice, affiliateCode: orderForm.affiliateCode.trim().toUpperCase() || '', affiliateCommission: commission }) }); setOrderStep(2); } catch (e) { setOrderError("Lỗi kết nối! Vui lòng thử lại."); } setIsSubmitting(false); };
            const handleSearchOrder = async (e) => { e.preventDefault(); setSearchEmailError(''); if (!isValidGmail(searchEmail)) { setSearchEmailError('Vui lòng nhập đúng địa chỉ Gmail (ví dụ: example@gmail.com)'); return; } setIsSearching(true); setMyOrders(null); try { const res = await fetch(`${SCRIPT_URL}?action=check_order&email=${searchEmail}`); const data = await res.json(); setMyOrders(data); } catch (e) { setMyOrders([]); } setIsSearching(false); };
            const handleFbSubmit = async (e) => { e.preventDefault(); if (!fbForm.email || !fbForm.email.includes('@')) { alert("Vui lòng nhập địa chỉ email hợp lệ!"); return; } setIsSubmitting(true); try { await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify({ action: 'submit_feedback', ...fbForm }) }); alert("Cảm ơn đánh giá của bạn!"); setFbForm({ name: '', email: '', message: '', rating: 5, type: 'Mua đề thi' }); setTimeout(fetchReviews, 2000); } catch (e) { alert("Lỗi gửi!"); } setIsSubmitting(false); };
            const renderMarqueeRow = (items, direction = 'left') => { if (items.length === 0) return null; let displayItems = [...items]; while (displayItems.length < 6) displayItems = [...displayItems, ...items]; return (<div className="relative flex overflow-hidden py-4"><div className="flex animate-marquee hover:[animation-play-state:paused]" style={{ animationDirection: direction === 'right' ? 'reverse' : 'normal' }}>{displayItems.map((review, idx) => <ReviewCard key={`${idx}-marquee`} review={review} />)}</div></div>); };
            const handleOrderChange = (e) => { const { name, value } = e.target; if (name === 'phone') { setOrderForm(prev => ({ ...prev, [name]: value.replace(/\D/g, '') })); return; } setOrderForm(prev => ({ ...prev, [name]: value })); };
            const incrementQuantity = () => setOrderForm(prev => ({ ...prev, quantity: Math.min(10, prev.quantity + 1) }));
            const decrementQuantity = () => setOrderForm(prev => ({ ...prev, quantity: Math.max(1, prev.quantity - 1) }));
            const handleInputChange = (e) => { const { name, value } = e.target; setFbForm(prev => ({ ...prev, [name]: value })); };
            const openLegalModal = (pageKey) => setLegalModal({ isOpen: true, pageKey });
            const closeLegalModal = () => setLegalModal({ isOpen: false, pageKey: null });

            return (
                <div className="min-h-screen bg-[#030712] text-gray-100 font-sans selection:bg-cyan-500 selection:text-white overflow-x-hidden">
                    <ParticleField />
                    <ShootingStars />
                    <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden"><div className="absolute top-0 left-1/4 w-[600px] h-[600px] bg-cyan-500/10 rounded-full blur-[128px] animate-pulse" /><div className="absolute bottom-0 right-1/4 w-[600px] h-[600px] bg-purple-500/10 rounded-full blur-[128px] animate-pulse" style={{ animationDelay: '1s' }} /><div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-blue-500/5 rounded-full blur-[128px]" /></div>
                    <div className="fixed top-0 left-0 right-0 h-1 z-[100] bg-gray-900/50"><div className="h-full bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500 transition-all duration-150" style={{ width: `${scrollProgress}%` }} /></div>
                    <LegalModal isOpen={legalModal.isOpen} onClose={closeLegalModal} pageKey={legalModal.pageKey} />
                    <SearchLoadingModal isOpen={isSearching} />

                    {/* Navbar */}
                    <nav className={`fixed top-0 w-full z-50 transition-all duration-300 ${scrolled ? 'bg-[#030712]/90 backdrop-blur-md border-b border-white/10' : 'bg-transparent'}`}>
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => window.scrollTo(0,0)}><div className="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center"><IconSparkles size={16} className="text-white" /></div><span className="font-bold text-xl tracking-tight">AstroMind</span></div>
                            <div className="hidden md:flex gap-6 items-center">{['Giữa kì', 'Cuối kì', 'Ứng dụng', 'Source Code', 'Affiliate', 'Tra cứu', 'Liên hệ'].map(item => (<button key={item} onClick={() => document.getElementById(item.toLowerCase().replace(/ /g,'-').replace(/ứ/g,'u').replace(/á/g,'a'))?.scrollIntoView({behavior:'smooth'})} className="text-gray-300 hover:text-white text-sm font-medium transition-colors relative group">{item}<span className="absolute bottom-0 left-0 w-0 h-0.5 bg-cyan-400 transition-all duration-300 group-hover:w-full"></span></button>))}<button onClick={fetchInventory} disabled={isLoadingStock} className="p-2 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 text-gray-400 hover:text-white transition-all" title="Cập nhật"><IconRefresh className={`w-4 h-4 ${isLoadingStock ? 'animate-spin' : ''}`} /></button></div>
                            <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="md:hidden text-white">{isMenuOpen ? <IconX /> : <IconMenu />}</button>
                        </div>
                        {isMenuOpen && (<div className="md:hidden bg-[#0A1220] border-t border-white/10 p-4 space-y-3">{['Giữa kì', 'Cuối kì', 'Ứng dụng', 'Source Code', 'Affiliate', 'Tra cứu', 'Liên hệ'].map(item => (<button key={item} onClick={() => { document.getElementById(item.toLowerCase().replace(/ /g,'-').replace(/ứ/g,'u').replace(/á/g,'a'))?.scrollIntoView({behavior:'smooth'}); setIsMenuOpen(false); }} className="block w-full text-left text-gray-300 py-2">{item}</button>))}</div>)}
                    </nav>

                    {/* Hero */}
                    <section id="home" className="relative pt-32 pb-20 px-4 text-center z-10 min-h-screen flex items-center justify-center">
                        <RevealOnScroll>
                            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border border-cyan-500/20 mb-8"><IconSparkles className="w-4 h-4 text-cyan-400" /><span className="text-sm text-cyan-400 font-medium">Nền tảng tài liệu học tập #1 Việt Nam</span></div>
                            <h1 className="text-5xl md:text-7xl lg:text-8xl font-extrabold mb-6 tracking-tight"><span className="block text-white mb-2">Khai Phá</span><span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600">Tri Thức Vũ Trụ</span></h1>
                            <p className="text-xl text-gray-400 max-w-2xl mx-auto mb-8">Đề thi Giữa kì, Cuối kì và tài khoản Premium chất lượng cao.</p>
                            <div className="flex flex-wrap justify-center gap-4 mb-12"><div className="px-4 py-2 rounded-full bg-blue-500/10 border border-blue-500/30 text-blue-400 text-sm"><IconFileText className="w-4 h-4 inline mr-2" />File PDF: <span className="font-bold">30.000đ</span></div><div className="px-4 py-2 rounded-full bg-green-500/10 border border-green-500/30 text-green-400 text-sm"><IconPlayCircle className="w-4 h-4 inline mr-2" />Quiz: <span className="font-bold">từ 6.000đ</span></div><div className="px-4 py-2 rounded-full bg-purple-500/10 border border-purple-500/30 text-purple-400 text-sm"><IconPackage className="w-4 h-4 inline mr-2" />Combo: <span className="font-bold">50.000đ</span></div></div>
                            <div className="flex flex-col sm:flex-row justify-center gap-4"><MagneticButton onClick={() => document.getElementById('giua-ki').scrollIntoView({ behavior: 'smooth' })} className="px-8 py-3 rounded-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-semibold text-base shadow-[0_0_20px_rgba(6,182,212,0.3)] hover:shadow-[0_0_30px_rgba(6,182,212,0.5)] flex items-center justify-center gap-2 transition-all duration-300 min-w-[240px]"><IconClipboardList size={18} /> ĐỀ GIỮA KÌ <IconChevronRight size={16} /></MagneticButton><MagneticButton onClick={() => document.getElementById('cuoi-ki').scrollIntoView({ behavior: 'smooth' })} className="px-8 py-3 rounded-full bg-white/5 hover:bg-white/10 border border-white/20 text-white font-semibold text-base backdrop-blur-md flex items-center justify-center gap-2 transition-all duration-300 hover:border-white/40 min-w-[240px]"><IconGraduationCap size={18} /> ĐỀ CUỐI KÌ</MagneticButton></div>
                        </RevealOnScroll>
                    </section>

                    {/* Stats */}
                    <section className="relative z-10 py-10 px-4"><RevealOnScroll delay={400}><div className="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 max-w-5xl mx-auto">{STATS.map((stat, idx) => (<GlassCard key={idx} className="p-4 md:p-6 text-center"><div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${stat.color} flex items-center justify-center mx-auto mb-3 shadow-lg`}>{React.cloneElement(stat.icon, { className: "w-6 h-6 text-white" })}</div><div className="text-2xl md:text-3xl font-bold text-white mb-1">{stat.value.includes('+') ? <><AnimatedCounter end={parseInt(stat.value)} />+</> : stat.value.includes('%') ? <><AnimatedCounter end={parseInt(stat.value)} />%</> : stat.value}</div><div className="text-sm text-gray-500">{stat.label}</div></GlassCard>))}</div></RevealOnScroll></section>

                    {/* GIỮA KÌ */}
                    <section id="giua-ki" className="py-20 px-4 max-w-7xl mx-auto"><RevealOnScroll><div className="flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-12"><div className="text-center md:text-left"><div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/20 mb-4"><IconClipboardList className="w-5 h-5 text-cyan-400" /><span className="text-sm text-cyan-400 font-medium">Tài liệu ôn tập</span></div><h2 className="text-3xl md:text-5xl font-bold text-white mb-4">Đề Thi Giữa Kì</h2><p className="text-gray-400 max-w-xl">Bộ sưu tập đề thi giữa kì từ các trường đại học hàng đầu</p></div><SearchBar searchTerm={searchGiuaKi} setSearchTerm={setSearchGiuaKi} placeholder="Tìm môn học hoặc trường..." accentColor="cyan" /></div></RevealOnScroll>{isLoadingStock ? (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">{[1,2,3].map(i => <SkeletonCard key={i} />)}</div>) : filteredGiuaKi.length > 0 ? (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">{filteredGiuaKi.map((course, idx) => (<CourseCard key={course.id} course={course} index={idx} onBuy={handleBuyClick} isLoadingStock={isLoadingStock} />))}</div>) : (<div className="text-center py-16"><IconSearch className="w-16 h-16 text-gray-600 mx-auto mb-4" /><p className="text-gray-400 text-lg">Không tìm thấy môn học "{searchGiuaKi}"</p><button onClick={() => setSearchGiuaKi('')} className="mt-4 text-cyan-400 hover:text-cyan-300 underline">Xóa bộ lọc</button></div>)}</section>

                    {/* CUỐI KÌ */}
                    <section id="cuoi-ki" className="py-20 px-4 max-w-7xl mx-auto"><RevealOnScroll><div className="flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-12"><div className="text-center md:text-left"><div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20 mb-4"><IconGraduationCap className="w-5 h-5 text-purple-400" /><span className="text-sm text-purple-400 font-medium">Tài liệu ôn tập</span></div><h2 className="text-3xl md:text-5xl font-bold text-white mb-4">Đề Thi Cuối Kì</h2><p className="text-gray-400 max-w-xl">Trọn bộ đề thi cuối kì đầy đủ nhất, cập nhật liên tục</p></div><SearchBar searchTerm={searchCuoiKi} setSearchTerm={setSearchCuoiKi} placeholder="Tìm môn học hoặc trường..." accentColor="purple" /></div></RevealOnScroll>{isLoadingStock ? (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">{[1,2,3].map(i => <SkeletonCard key={i} />)}</div>) : filteredCuoiKi.length > 0 ? (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">{filteredCuoiKi.map((course, idx) => (<CourseCard key={course.id} course={course} index={idx} onBuy={handleBuyClick} isLoadingStock={isLoadingStock} />))}</div>) : (<div className="text-center py-16"><IconSearch className="w-16 h-16 text-gray-600 mx-auto mb-4" /><p className="text-gray-400 text-lg">Không tìm thấy môn học "{searchCuoiKi}"</p><button onClick={() => setSearchCuoiKi('')} className="mt-4 text-purple-400 hover:text-purple-300 underline">Xóa bộ lọc</button></div>)}</section>

                    {/* Apps */}
                    <section id="ung-dung" className="py-20 px-4 max-w-7xl mx-auto"><RevealOnScroll><div className="text-center mb-16"><h2 className="text-3xl md:text-5xl font-bold text-white mb-6">Tài Khoản & Ứng Dụng</h2><div className="h-1 w-24 bg-gradient-to-r from-emerald-500 to-teal-500 mx-auto rounded-full" /></div></RevealOnScroll><div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">{[...apps].sort(sortByStock).map((acc, idx) => (<AccountCard key={acc.id} account={acc} index={idx} onBuy={handleBuyClick} />))}</div></section>

                    {/* Source Code */}
                    <section id="source-code" className="py-20 px-4 max-w-7xl mx-auto"><RevealOnScroll><div className="text-center mb-16"><div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border border-cyan-500/20 mb-4"><IconCode className="w-5 h-5 text-cyan-400" /><span className="text-sm text-cyan-400 font-medium">Dành cho Developer</span></div><h2 className="text-3xl md:text-5xl font-bold text-white mb-6">Source Code & Project</h2><p className="text-gray-400 max-w-2xl mx-auto">Mua source code chất lượng hoặc đặt làm dự án theo yêu cầu</p><div className="h-1 w-24 bg-gradient-to-r from-cyan-500 to-purple-500 mx-auto rounded-full mt-6" /></div></RevealOnScroll><div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">{[...sourceCode].sort(sortByStock).map((item, idx) => (<SourceCodeCard key={item.id} item={item} index={idx} onBuy={handleBuyClick} />))}</div></section>

                    {/* AFFILIATE */}
                    <AffiliateSection />

                    {/* ORDER FORM */}
                    <section id="dat-hang" className={`py-20 px-4 transition-all duration-500 ${selectedProduct ? 'block' : 'hidden'}`}>
                        <div className="max-w-3xl mx-auto">
                            <GlassCard className="p-8 border-cyan-500/30">
                                <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-cyan-400">{orderStep === 1 ? 'Thông Tin Đặt Hàng' : orderStep === 1.5 ? 'Xác Nhận Thông Tin' : orderStep === 2 ? 'Thanh Toán' : 'Thành Công'}</h2><button onClick={() => { setSelectedProduct(null); setSelectedPackage(null); }} className="text-gray-400 hover:text-white"><IconX /></button></div>
                                {orderError && (<div className="mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg flex items-center gap-2 text-red-300 text-sm animate-fade-in-down"><IconAlertCircle size={16} />{orderError}</div>)}
                                {orderStep === 1 ? (<form onSubmit={handleOrderSubmit} className="space-y-4"><div className="bg-white/5 p-4 rounded-xl mb-4 border border-white/10"><div className="flex items-start gap-4 mb-4">{selectedProduct?.image && (<img src={optimizeImageUrl(selectedProduct.image, 100, 70)} alt="" className="w-16 h-16 rounded-xl object-cover" loading="lazy" />)}<div className="flex-1"><h3 className="font-bold text-white">{selectedProduct?.title}</h3>{selectedPackage && (<div className="flex items-center gap-2 mt-1"><span className={`px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r ${selectedPackage.color} text-white`}>{selectedPackage.name}</span></div>)}</div></div>{selectedPackage && (<div className="bg-black/30 p-3 rounded-lg mb-3"><p className="text-sm text-gray-400 mb-2">{selectedPackage.description}</p><ul className="text-xs text-gray-500 space-y-1">{selectedPackage.features.map((f, i) => (<li key={i} className="flex items-center gap-1"><IconCheck className="w-3 h-3 text-green-400" />{f}</li>))}</ul></div>)}<div className="flex items-center justify-between border-t border-white/10 pt-3"><span className="text-gray-400 text-sm">Số lượng:</span><div className="flex items-center gap-3"><button type="button" onClick={decrementQuantity} className="p-1 rounded-full bg-white/10 hover:bg-white/20 text-white"><IconMinus size={16} /></button><span className="text-white font-bold w-6 text-center">{orderForm.quantity}</span><button type="button" onClick={incrementQuantity} className="p-1 rounded-full bg-white/10 hover:bg-white/20 text-white"><IconPlus size={16} /></button></div></div><div className="flex justify-between items-center border-t border-white/10 pt-3 mt-3"><span className="text-white font-bold">Tổng tiền:</span><span className="text-xl font-bold text-green-400">{getTotalPrice().toLocaleString('vi-VN')}đ</span></div></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><input required placeholder="Họ và Tên" className="bg-black/30 border border-gray-700 rounded-2xl p-3 outline-none focus:border-cyan-500 text-white" value={orderForm.name} onChange={handleOrderChange} name="name" /><input required placeholder="Số điện thoại (10 số)" className="bg-black/30 border border-gray-700 rounded-2xl p-3 outline-none focus:border-cyan-500 text-white" value={orderForm.phone} onChange={handleOrderChange} name="phone" maxLength={10} /></div><input required type="email" placeholder="Email (Để nhận tài liệu)" className="w-full bg-black/30 border border-gray-700 rounded-2xl p-3 outline-none focus:border-cyan-500 text-white" value={orderForm.email} onChange={handleOrderChange} name="email" /><AffiliateCodeInput value={orderForm.affiliateCode} onChange={(val) => { setOrderForm(prev => ({ ...prev, affiliateCode: val })); setIsAffiliateValid(null); setAffiliateError(''); }} onValidate={validateAffiliateCode} isValid={isAffiliateValid} isChecking={isCheckingAffiliate} error={affiliateError} /><div className="flex items-start gap-2 p-3 bg-blue-500/10 border border-blue-500/30 rounded-xl text-sm"><IconMail className="w-5 h-5 text-blue-400 shrink-0 mt-0.5" /><p className="text-blue-300">Tài liệu/tài khoản sẽ được gửi tự động qua email sau khi thanh toán thành công.</p></div><button disabled={isSubmitting || isCheckingAffiliate} className="w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-full font-bold hover:opacity-90 transition-opacity disabled:opacity-50">Tiếp tục</button></form>) : orderStep === 1.5 ? (<div className="space-y-6"><div className="bg-white/5 p-6 rounded-2xl border border-white/10 space-y-3"><h3 className="text-lg font-bold text-white border-b border-white/10 pb-2 mb-2">Vui lòng kiểm tra lại</h3><p className="flex justify-between"><span className="text-gray-400">Sản phẩm:</span> <span className="font-medium text-white">{selectedProduct?.title}</span></p>{selectedPackage && (<p className="flex justify-between"><span className="text-gray-400">Gói:</span> <span className="text-cyan-400 font-medium">{selectedPackage.name}</span></p>)}<p className="flex justify-between"><span className="text-gray-400">Đơn giá:</span> <span className="text-white">{selectedPackage ? selectedPackage.priceDisplay : selectedProduct?.price}</span></p><p className="flex justify-between"><span className="text-gray-400">Số lượng:</span> <span className="font-bold text-white">{orderForm.quantity}</span></p><p className="flex justify-between border-t border-white/10 pt-2"><span className="text-gray-400">Tổng tiền:</span> <span className="font-bold text-green-400 text-lg">{getTotalPrice().toLocaleString('vi-VN')}đ</span></p>{orderForm.affiliateCode && isAffiliateValid && (<div className="border-t border-white/10 pt-2 mt-2"><p className="flex justify-between items-center"><span className="text-gray-400 flex items-center gap-1"><IconTicket className="w-4 h-4 text-amber-400" />Mã giới thiệu:</span><span className="font-bold text-amber-400">{orderForm.affiliateCode}</span></p><p className="text-xs text-gray-500 mt-1 text-right">Hoa hồng 20%: {getAffiliateCommission().toLocaleString('vi-VN')}đ</p></div>)}<div className="border-t border-white/10 pt-2 mt-2"><p className="flex justify-between"><span className="text-gray-400">Họ tên:</span> <span className="text-white">{orderForm.name}</span></p><p className="flex justify-between"><span className="text-gray-400">SĐT:</span> <span className="text-white">{orderForm.phone}</span></p><p className="flex justify-between"><span className="text-gray-400">Email:</span> <span className="text-white">{orderForm.email}</span></p></div></div><div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4"><div className="flex items-start gap-2"><IconAlertTriangle className="w-5 h-5 text-amber-400 shrink-0 mt-0.5" /><div className="text-sm text-amber-200"><p className="font-bold mb-1">Lưu ý quan trọng:</p><ul className="list-disc ml-4 space-y-1 text-amber-300/80"><li>Vui lòng chuyển <strong>ĐÚNG SỐ TIỀN</strong> và <strong>ĐÚNG NỘI DUNG</strong> chuyển khoản</li><li>Nếu chuyển thiếu/nhầm, đơn hàng sẽ không được xử lý tự động</li><li>Liên hệ hỗ trợ trong vòng 24h nếu có vấn đề</li></ul></div></div></div><div className="flex gap-4"><button onClick={() => setOrderStep(1)} className="flex-1 py-3 bg-gray-700 rounded-full font-bold hover:bg-gray-600 text-white">Quay lại</button><button onClick={handleConfirmOrder} disabled={isSubmitting} className={`flex-1 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-full font-bold hover:opacity-90 text-white ${isSubmitting ? 'opacity-50 cursor-wait' : ''}`}>{isSubmitting ? <><IconLoader className="inline w-4 h-4 animate-spin mr-2" />Đang xử lý...</> : 'Xác nhận & Thanh toán'}</button></div></div>) : orderStep === 2 ? (<div className="text-center space-y-6"><div className="bg-white p-4 rounded-3xl w-80 h-80 mx-auto shadow-lg shadow-white/10"><img src={`${BANK_INFO.qrLink}?amount=${getTotalPrice()}&addInfo=${generatedOrderId}&accountName=${encodeURIComponent(BANK_INFO.accountName)}`} alt="QR Thanh Toan" className="w-full h-full object-contain" loading="lazy" /></div><div className="bg-white/5 p-4 rounded-2xl text-left space-y-2 text-sm border border-white/10"><p className="flex justify-between items-center"><span>Ngân hàng:</span> <span className="font-bold text-white flex items-center gap-2">{BANK_INFO.bankId}<CopyButton text={BANK_INFO.bankId} /></span></p><p className="flex justify-between items-center"><span>Số tài khoản:</span> <span className="font-bold text-white flex items-center gap-2">{BANK_INFO.accountNum}<CopyButton text={BANK_INFO.accountNum} /></span></p><p className="flex justify-between items-center"><span>Chủ tài khoản:</span> <span className="font-bold text-white flex items-center gap-2">{BANK_INFO.accountName}<CopyButton text={BANK_INFO.accountName} /></span></p><p className="flex justify-between items-center text-yellow-400 border-t border-white/10 pt-2 mt-2"><span>Nội dung CK:</span> <span className="font-bold flex items-center gap-2">{generatedOrderId}<CopyButton text={generatedOrderId} /></span></p><p className="flex justify-between items-center pt-2"><span>Số tiền:</span> <span className="font-bold text-green-400 flex items-center gap-2">{getTotalPrice().toLocaleString('vi-VN')}đ<CopyButton text={getTotalPrice().toString()} /></span></p></div><div className="bg-red-500/10 border border-red-500/30 rounded-xl p-3 text-left"><p className="text-red-300 text-xs flex items-start gap-2"><IconAlertCircle className="w-4 h-4 shrink-0 mt-0.5" /><span>Chuyển khoản ĐÚNG số tiền <strong>{getTotalPrice().toLocaleString('vi-VN')}đ</strong> và nội dung <strong>{generatedOrderId}</strong>. Nếu sai, hệ thống sẽ không xử lý tự động.</span></p></div><div className="flex flex-col items-center justify-center gap-3 mt-6"><IconLoader className="animate-spin text-cyan-400 w-10 h-10" /><span className="text-sm text-cyan-400 animate-pulse">Đang chờ thanh toán...</span></div><button onClick={() => setOrderStep(1)} className="text-gray-400 underline hover:text-white text-xs">Quay lại</button></div>) : (<div className="text-center py-10 animate-fade-in"><div className="w-20 h-20 bg-green-500/20 text-green-400 rounded-full flex items-center justify-center mx-auto mb-6"><IconCheckCircle size={40} /></div><h3 className="text-2xl font-bold text-white mb-4">Thanh Toán Thành Công!</h3><div className="bg-green-900/30 border border-green-500/30 p-4 rounded-2xl mb-6"><p className="text-sm text-gray-300 mb-2">Link tài liệu / Tài khoản của bạn:</p><div className="flex items-center justify-center gap-3"><div className="text-xl font-mono font-bold text-green-400 break-all select-all whitespace-pre-line flex-1">{paidKey}</div><CopyButton text={paidKey} className="shrink-0" /></div></div><div className="bg-blue-500/10 border border-blue-500/30 p-3 rounded-xl mb-6 text-left"><div className="flex items-start gap-2"><IconMail className="w-5 h-5 text-blue-400 shrink-0 mt-0.5" /><p className="text-sm text-blue-300">Thông tin này cũng đã được gửi đến email <strong>{orderForm.email}</strong>. Vui lòng kiểm tra hộp thư (kể cả Spam).</p></div></div><p className="text-gray-400 text-sm mb-6">Vui lòng lưu lại thông tin này.</p><button onClick={() => { setSelectedProduct(null); setSelectedPackage(null); }} className="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-full text-white">Đóng</button></div>)}
                            </GlassCard>
                        </div>
                    </section>

                    {/* CHECK ORDER */}
                    <section id="tra-cuu" className="py-20 px-4 max-w-2xl mx-auto text-center"><h2 className="text-3xl font-bold mb-8 text-white">Tra Cứu Đơn Hàng</h2><GlassCard className="p-6"><form onSubmit={handleSearchOrder} className="space-y-4 mb-6"><div className="flex gap-2"><div className="flex-1 relative"><input required type="email" placeholder="Nhập Email Gmail của bạn..." className={`w-full bg-black/40 border rounded-2xl px-4 py-3 outline-none text-white ${searchEmailError ? 'border-red-500 focus:border-red-500' : 'border-gray-700 focus:border-cyan-500'}`} value={searchEmail} onChange={e => { setSearchEmail(e.target.value); setSearchEmailError(''); }} />{searchEmailError && (<p className="absolute -bottom-5 left-0 text-xs text-red-400">{searchEmailError}</p>)}</div><button disabled={isSearching} className="bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 px-6 rounded-2xl flex items-center justify-center gap-2 text-white font-medium transition-all"><IconSearch className="w-5 h-5" /><span className="hidden sm:inline">Tìm</span></button></div><p className="text-xs text-gray-500 text-left">* Chỉ hỗ trợ tra cứu với địa chỉ Gmail (example@gmail.com)</p></form>{myOrders !== null && (<div className="text-left space-y-3 animate-fade-in mt-8">{Array.isArray(myOrders) && myOrders.length > 0 ? myOrders.map((order, i) => (<div key={i} className="bg-black/30 p-4 rounded-2xl border border-gray-700"><div className="flex justify-between mb-1"><span className="font-bold text-white">{order.product}</span><span className={`text-xs px-2 py-0.5 rounded-full ${order.status === 'Đã thanh toán' || order.status === 'Paid' ? 'bg-green-500/20 text-green-400' : order.status === 'Partial' ? 'bg-orange-500/20 text-orange-400' : 'bg-yellow-500/20 text-yellow-400'}`}>{order.status === 'Paid' ? 'Đã thanh toán' : order.status === 'Partial' ? 'Chuyển thiếu' : order.status}</span></div><div className="mt-2 p-3 bg-black/40 rounded-xl border border-white/5"><div className="flex items-start justify-between gap-2"><div className="text-sm text-gray-300 break-all font-mono whitespace-pre-line flex-1">{order.delivery || "Đang chờ cập nhật..."}</div>{order.delivery && (<CopyButton text={order.delivery} className="shrink-0 mt-0.5" />)}</div></div></div>)) : (<div className="text-center py-8"><IconSearch className="w-12 h-12 text-gray-600 mx-auto mb-3" /><p className="text-gray-400">Không tìm thấy đơn hàng nào với email này.</p><p className="text-gray-500 text-sm mt-2">Vui lòng kiểm tra lại email hoặc liên hệ hỗ trợ.</p></div>)}</div>)}</GlassCard></section>

                    {/* Feedback */}
                    <section id="feedback" className="relative z-10 py-20 overflow-hidden"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16 text-center"><RevealOnScroll><h2 className="text-3xl md:text-5xl font-bold text-white mb-6">Học Viên Nói Gì?</h2><div className="h-1 w-24 bg-gradient-to-r from-cyan-500 to-blue-500 mx-auto rounded-full" /></RevealOnScroll></div>{reviews.length > 0 && (<div className="mb-20 space-y-8">{renderMarqueeRow(reviews.slice(0, Math.ceil(reviews.length / 2)), 'left')}{renderMarqueeRow(reviews.slice(Math.ceil(reviews.length / 2)), 'right')}</div>)}<div className="max-w-2xl mx-auto px-4"><GlassCard className="p-8"><h3 className="text-2xl font-bold text-white mb-6 text-center">Gửi Đánh Giá</h3><form onSubmit={handleFbSubmit} className="space-y-6"><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><input required placeholder="Tên của bạn" className="bg-black/30 border border-gray-700 rounded-2xl p-3 outline-none focus:border-cyan-500 text-white" value={fbForm.name} onChange={handleInputChange} name="name" /><input required type="email" placeholder="Email (Bắt buộc)" className="bg-black/30 border border-gray-700 rounded-2xl p-3 outline-none focus:border-cyan-500 text-white" value={fbForm.email} onChange={handleInputChange} name="email" /></div><div className="grid grid-cols-1 md:grid-cols-2 gap-6 items-start"><div><label className="block text-sm font-medium text-gray-300 mb-2">Đánh giá</label><div className="flex gap-2">{[1,2,3,4,5].map(s => (<IconStar key={s} onClick={() => setFbForm({...fbForm, rating: s})} className={`cursor-pointer ${s <= fbForm.rating ? 'fill-amber-400 text-amber-400' : 'text-gray-600'}`} />))}</div></div><div><label className="block text-sm font-medium text-gray-300 mb-2">Loại đánh giá</label><div className="flex gap-2 bg-white/5 p-1 rounded-lg border border-white/10">{['Mua đề thi', 'Mua App'].map((type) => (<button key={type} type="button" onClick={() => setFbForm({...fbForm, type })} className={`flex-1 py-1.5 px-3 rounded-md text-xs font-medium transition-all ${fbForm.type === type ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-sm' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>{type}</button>))}</div></div></div><textarea required placeholder="Chia sẻ cảm nhận..." rows={4} className="w-full bg-black/30 border border-gray-700 rounded-2xl p-3 outline-none focus:border-cyan-500 text-white" value={fbForm.message} onChange={handleInputChange} name="message" /><button disabled={isSubmitting} className={`w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-full font-bold hover:opacity-90 ${isSubmitting ? 'opacity-50 cursor-wait' : ''}`}>{isSubmitting ? <><IconLoader className="inline w-4 h-4 animate-spin mr-2" />Đang gửi...</> : 'Gửi Đánh Giá'}</button></form></GlassCard></div></section>

                    {/* FEATURES */}
                    <section className="relative z-10 py-16"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><RevealOnScroll><div className="text-center mb-12"><h2 className="text-3xl md:text-4xl font-bold text-white mb-4">Tại Sao Chọn AstroMind?</h2><p className="text-gray-400">Cam kết mang đến trải nghiệm tốt nhất cho bạn</p></div></RevealOnScroll><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">{FEATURES.map((feature, idx) => (<RevealOnScroll key={idx} delay={idx * 100}><GlassCard className="p-6 text-center h-full flex flex-col items-center"><div className={`w-14 h-14 rounded-2xl bg-gradient-to-br ${feature.color} flex items-center justify-center mx-auto mb-4 shadow-lg`}>{React.cloneElement(feature.icon, { className: "w-7 h-7 text-white" })}</div><h3 className="text-lg font-bold text-white mb-2">{feature.title}</h3><p className="text-sm text-gray-500 flex-1">{feature.description}</p></GlassCard></RevealOnScroll>))}</div></div></section>

                    {/* Footer */}
                    <section id="lien-he" className="py-12 border-t border-white/10 bg-[#020612]"><div className="max-w-7xl mx-auto px-4"><div className="text-center mb-8"><h2 className="text-2xl font-bold mb-8 text-white">Kết Nối</h2><div className="flex justify-center gap-6 mb-8">{SOCIAL_LINKS.map((s, i) => (<a key={i} href={s.url} className={`p-3 rounded-full bg-gradient-to-r ${s.color} hover:scale-110 transition-transform`}><span className="text-white">{s.icon}</span></a>))}</div></div><div className="flex flex-wrap justify-center gap-6 mb-8 text-sm"><button onClick={() => openLegalModal('terms')} className="text-gray-400 hover:text-cyan-400 flex items-center gap-2 transition-colors"><IconScale className="w-4 h-4" />Điều khoản sử dụng</button><button onClick={() => openLegalModal('privacy')} className="text-gray-400 hover:text-cyan-400 flex items-center gap-2 transition-colors"><IconLock className="w-4 h-4" />Chính sách bảo mật</button><button onClick={() => openLegalModal('refund')} className="text-gray-400 hover:text-cyan-400 flex items-center gap-2 transition-colors"><IconRotateCcw className="w-4 h-4" />Chính sách hoàn tiền</button></div><p className="text-gray-500 text-sm text-center">© 2025 AstroMind. All rights reserved.</p></div></section>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GalaxyShop />);
    </script>
</body>
</html>
